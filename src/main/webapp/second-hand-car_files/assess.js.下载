$(function(){
    // dealerCity();
    //getcityList1();
    //getcityList2();
    getDealercityList1();
    //getDealercityList2();
    year1();
    setareat("area","selectcity","city");
//	getcarname1();

    //热门搜索
    $("#searchtj a").on("click",function(){
        //alert("这里是热门搜索");
        var tj=$(this).html();
        txt = encodeURI(encodeURI(tj));
        alert(path+"/search?type=c&query="+txt);
        location.href=path+"/search?type=c&query="+txt;
    });




    //上牌地区

    $('#pcregion').click(function(){


        if($(this).html()=="上牌地区"){

            $('#pcdiqu').html('<span><img src="'+path+'/images/manage/prompt.png"></span>请选择地区');
        }else{
            $('#pcdiqu').css('display','none');
            /*$('#pcdiqu').html("");*/
        }

    });
    //公里数
    $('#run').blur(function(){
        _smq.push(['custom','pc/填写里程数__主视觉','填写里程数',new Date()]);

        var run =$(this).val();
        var reg = /^(([1-9]+)|([1-9][0-9]+)|([0-9]+\.[0-9]{1,2}))$/;

        if(run==''){
            $('#pcrun').css("display","block");
            $('#pcrun').html('<span><img src="'+path+'/images/manage/prompt.png"></span>请填写行驶里程');
        }else if(!reg.test(run)){
            $('#pcrun').css("display","block");
            $('#pcrun').html('<span><img src="'+path+'/images/manage/prompt.png"></span>行驶里程格式不正确');

        }else if(parseInt(run)> parseInt(100)){
            $('#pcrun').css("display","block");
            $('#pcrun').html('<span><img src="'+path+'/images/manage/prompt.png"></span>行驶里程大于100万公里');
        }else{
            $('#pcrun').css('display','none');
        }




    });



//现有品牌
    $('#pinpai').click(function(){
        _smq.push(['custom','pc/选择现有车辆品牌__主视觉','现有车辆品牌',new Date()]);
    });

//上牌地区
    $('#indentical').click(function(){
        _smq.push(['custom','pc/选择上牌地区__主视觉','选择上牌地区',new Date()]);
    });






});

function onLineToTake(){
    fromPageName = "A3 2012款 2.0T 自动 30 TFSI";
    fromPageUrl = window.location.href;
    ipRegion = "北京";
    ipnum = "192.168.0.104";
    carTypeName = "A3";
    carTypeId = "8631";
    fromPageName=$("#fromPageName").html();
    carTypeName=$("#carTypeName").val();
    carTypeId=$("#carTypeId").val();
    ipRegion = $("#ipRegion").val();


    takeTo = $("#dealerId").val().toLowerCase();
    alertText="assInitPage";
    alert(takeTo);
    onLineTake();
}



//上牌地区控制


//图片
function imgchang(src,size){
    var index=src.lastIndexOf(".");
    if(index>0){
        var imgtype=src.substring(index);
        src=src.replace(imgtype,"_"+size+imgtype);
    }
    return src;
}

var zm=['A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z'];
function getcityList1(){

    $("#citylist1").empty();//清空原list
    var num=0;//定义num来判断zm和dcity中的字母是否匹配
    for ( var j = 0; j < dcitys.length; j++) {
        if(j>=0){
            var dcity=dcitys[j];//获取每一个dcity对象
            var number=dcity[0];//获取id
            var name=dcity[1];//获取字母与名称
            name=name.split(" "); //分割空格 获取字母与名称的数组
            if(zm[i]==name[0]){

                if(num<1){
                    $("#citylist1").append("<dl><dt>"+name[0]+"</dt><dd><span><a href='"+path+"sk?curcity="+number+ "' >"+name[1]+"</a></span></dd></dl>");
                }else{
                    $("#citylist1 dl:last dd:last").append("<span><a href='"+path+"sk?curcity="+number+ "' >"+name[1]+"</a></span>");

                }
                num=num+1;
            }
        }
    }
}
//}
function getcityList2(){
    /*$("#citylist2").empty();//清空原list
     */			for ( var i = 0; i < zm.length; i++) {//循环zm 由于dcitys里的顺序本身就是按照abcd来排序的所以不需要逐个和zm里的ABCD进行比对，只需要按照zm的顺序循环比对即可
        var num=0;//定义num来判断zm和dcity中的字母是否匹配
        for ( var j = 0; j < dcitys.length; j++) {
            if(j>=0){
                var dcity=dcitys[j];//获取每一个dcity对象
                var number=dcity[0];//获取id
                var name=dcity[1];//获取字母与名称
                name=name.split(" "); //分割空格 获取字母与名称的数组

                if(zm[i]==name[0]){//如果zm与dcity的字母相同则把对应的信息拼接出来，如果没有相同的则dd不显示对应zm里的字母。

                    if(num<1){

                        $("#citylist2").append("<dl><dt>"+name[0]+"</dt><dd><span><a href='"+path+"assess_init?ci_ciArea="+number+ "' onclick=changecity('"+number+"')>"+name[1]+"</a></span></dd></dl>");
                    }else{
                        //如果在相同zm里已经有dl则直接在dd里面拼接span
                        $("#citylist2 dl:last dd:last").append("<span><a href='"+path+"assess_init?ci_ciArea="+number+"' onclick=changecity('"+number+"')>"+name[1]+"</a></span>");

                    }
                    num=num+1;
                }
            }
        }
    }
}

function getDealercityList1(){
    $("#citylist1").empty();//清空原list
    $.ajax({
        type : "POST",  //提交方式
        url : path+"/openCities",//路径
        success : function(result) {//返回数据根据结果进行相应的处理
            var json = $.parseJSON(result);

            if (json==null||json.msg==null ||json.msg==undefined) {

            } else {
                var obj=eval(json.msg);
                for ( var i = 0; i < zm.length; i++) {//循环zm 由于dcitys里的顺序本身就是按照abcd来排序的所以不需要逐个和zm里的ABCD进行比对，只需要按照zm的顺序循环比对即可
                    var num=0;//定义num来判断zm和dcity中的字母是否匹配
                    for ( var j = 0; j < obj.length; j++) {
                        if(j>=0){
                            var dcity=obj[j];//获取每一个dcity对象
                            var number=dcity.CID;//获取id
                            var name=dcity.REMARK;//获取字母与名称
                            name=name.split(" "); //分割空格 获取字母与名称的数组
                            if(zm[i]==name[0]){//如果zm与dcity的字母相同则把对应的信息拼接出来，如果没有相同的则dd不显示对应zm里的字母。
                                if(num<1){
                                    //$("#citylist1").append("<dl><dt>"+name[0]+"</dt><dd><span><a href='"+path+"sk?curcity="+number+ "' >"+name[1]+"</a></span></dd></dl>");
                                    $("#citylist1").append("<dl><dt>"+name[0]+"</dt><dd><span><a href=javascript:showChangeCity('"+number+"','"+name[1]+"')>"+name[1]+"</a></span></dd></dl>");
                                    $("#citylist2").append("<dl><dt>"+name[0]+"</dt><dd><span><a href='"+path+"assess_init?ci_ciArea="+number+ "' onclick=changecity('"+number+"')>"+name[1]+"</a></span></dd></dl>");
                                }else{
                                    //$("#citylist1 dl:last dd:last").append("<span><a href='"+path+"sk?curcity="+number+ "' >"+name[1]+"</a></span>");
                                    $("#citylist1 dl:last dd:last").append("<span><a href=javascript:showChangeCity('"+number+"','"+name[1]+"')>"+name[1]+"</a></span>");
                                    $("#citylist2 dl:last dd:last").append("<span><a href='"+path+"assess_init?ci_ciArea="+number+"' onclick=changecity('"+number+"')>"+name[1]+"</a></span>");
                                }
                                num=num+1;
                            }
                        }
                    }
                }
            }
        }
    });
}

function getDealercityList2(){
    //$("#citylist2").empty();//清空原list
    $.ajax({
        type : "POST",  //提交方式
        url : path+"/openCities",//路径
        success : function(result) {//返回数据根据结果进行相应的处理
            var json = $.parseJSON(result);

            if (json==null||json.msg==null ||json.msg==undefined) {

            } else {
                var obj=eval(json.msg);
                for ( var i = 0; i < zm.length; i++) {//循环zm 由于dcitys里的顺序本身就是按照abcd来排序的所以不需要逐个和zm里的ABCD进行比对，只需要按照zm的顺序循环比对即可
                    var num=0;//定义num来判断zm和dcity中的字母是否匹配
                    for ( var j = 0; j < obj.length; j++) {
                        if(j>=0){
                            var dcity=obj[j];//获取每一个dcity对象
                            var number=dcity.CID;//获取id
                            var name=dcity.REMARK;//获取字母与名称
                            name=name.split(" "); //分割空格 获取字母与名称的数组
                            if(zm[i]==name[0]){//如果zm与dcity的字母相同则把对应的信息拼接出来，如果没有相同的则dd不显示对应zm里的字母。
                                if(num<1){
                                    $("#citylist2").append("<dl><dt>"+name[0]+"</dt><dd><span><a href='"+path+"assess_init?ci_ciArea="+number+ "' onclick=changecity('"+number+"')>"+name[1]+"</a></span></dd></dl>");
                                }else{
                                    //如果在相同zm里已经有dl则直接在dd里面拼接span
                                    $("#citylist2 dl:last dd:last").append("<span><a href='"+path+"assess_init?ci_ciArea="+number+"' onclick=changecity('"+number+"')>"+name[1]+"</a></span>");
                                }
                                num=num+1;
                            }
                        }
                    }
                }
            }
        }
    });
}



function getcityforid(cid){
    for ( var j = 0; j < dcitys.length; j++) {
        var dcity=dcitys[j];//获取每一个dcity对象
        var number=dcity[0];//获取id
        if(number==cid){
            var name=dcity[1];//获取字母与名称
            name=name.split(" "); //分割空格 获取字母与名称的数组
            return name[1];
        }
    }

    return getCity(cid);
}
function getCity(txt){
    for (var i = 0;i<ocity.length;i++){
        var d = ocity[i];
        var code = d[0];
        if(txt==code){
            var name=d[1];
            return name;
        }
    }

    if(txt==""){
        return "全国城市";
    }


    return "UNKNOW";
}


function setareat(idstr,idstr2,idstr3){
//		var cityname=getcityforid($("#"+idstr).text());
    var cityname=getcityforid($("#"+idstr).attr("citynameid"));
    var down = '&nbsp;<span class="icon-down"></span>';
    $("#"+idstr).html(cityname+down);
    $("#"+idstr2).text(cityname);
    var cityname2 = getcityforid($("#"+idstr3).attr("citynameid"));
    $("#"+idstr3).text(cityname2);
}
//车系的获取
function ck(data){

    if($('#'+data.id+'').html()=="现有车辆品牌"){

        $('#brandcar').html('<span><img src="'+path+'/images/manage/prompt.png"></span>现有车辆品牌');
    }else{
        $('#brandcar').css('display','none');
        /*$('#brandcar').html("");*/
        $(".select_2").find("p").html('请选择车系');

        $(".select_3").find("p").html('请选择车型');
        /*$('#brandcar').css('display','none');*/
    }


    getconajax(data.id);

}
function ckchang(){

    $('#brandcar').css('display','none');
    $(".select_1").find("p").html('现有车辆品牌');
    /*$('#brandcar').html("");*/
    $(".select_2").find("p").html('请选择车系');

    $(".select_3").find("p").html('请选择车型');
    /*$('#brandcar').css('display','none');*/

}
function getconajax(id){



    $.ajax({
        type: "POST",
        url: path+"/getconajax.json",
        data:{"id":id},
        async: false,//设置同步提交，这样可以将值返回
        dataType: "json",
        success:function(data){
            $("#cartypelist").empty();//由于切换是ajax不刷新页面所以，在更新车辆时得清空下
            var div="";
            for(var i in data){
                var obj=data[i];
                if(i==0){
                    div+="<li class='first'><a id='actl"+obj.cd_cid+"' onclick='cktype("+obj.cd_cid+")' href='javascript:;'>"+obj.cd_cnname+"</a></li>";
                }else{
                    div+="<li><a id='actl"+obj.cd_cid+"' onclick='cktype("+obj.cd_cid+")' href='javascript:;'>"+obj.cd_cnname+"</a></li>";
                }
            }

            $("#cartypelist").append(div);
            //车系
            $("#cartypelist li a").click(function(){
                _smq.push(['custom','pc/选择车系__主视觉','选择车系',new Date()]);
                var _this = $(this);
                var txt = _this.html();
                _this.parent().parent().parent().find("p").html(txt);
                _this.parent().parent().parent().removeClass('selected active');
            });
        }
    });
}
// 车型的获取
function cktype(id){
    if($('#'+id+'').html()=="请选择车系"){
        $('#pccar').html('<span><img src="'+path+'/images/manage/prompt.png"></span>请选择车系');
    }else{
        $('#pccar').css('display','none');
        /*$('#pccar').html("");*/
        $(".select_3").find("p").html('请选择车型');

    }
    $.ajax({
        type: "POST",
        url: path+"/getconajaxcartype.json",
        data:{"id":id},
        //async: false,//设置同步提交，这样可以将值返回
        dataType: "json",
        success:function(data){
            $("#cartypel").empty();//由于切换是ajax不刷新页面所以，在更新车辆时得清空下
            var div="";
            for(var i in data){
                var obj=data[i];
                if(obj.cd_remark.length>4){
                    obj.cd_remark = obj.cd_remark.substring(0,4);
                }

                if(i==0){
                    div+="<li class='first'><a id="+obj.cd_tabid+"  href='javascript:;'>"+obj.cd_remark+obj.cd_cnname+"</a></li>";
                }else{
                    div+="<li><a id='"+obj.cd_tabid+"' href='javascript:;'>"+obj.cd_remark+obj.cd_cnname+"</a></li>";

                }
            }

            $("#cartypel").append(div);
            //车型
            $("#cartypel li a").click(function(){
                _smq.push(['custom','pc/选择车型__主视觉','选择车型',new Date()]);

                var _this = $(this);

                var txt = _this.html();

                if(txt=="请选择车型"){

                    $('#pcModels').html('<span><img src="'+path+'/images/manage/prompt.png"></span>请选择车型');
                }else{
                    $('#pcModels').css('display','none');
                    /*$('#pcModels').html("");*/
                }


                var code=_this.attr("id");
                _this.parent().parent().parent().find("p").attr("id",code);
                _this.parent().parent().parent().find("p").html(txt);
                _this.parent().parent().parent().removeClass('selected active');
            });
        }
    });

}

// 获取信息后向后台提交信息跳转
function clic(){
    _smq.push(['custom','pc/立即在线评估__主视觉','立即在线评估',new Date()]);

    if(getjudge()==true){
        //		var month= $('#month p').html() == "上牌月份" ? "" : $('#month p').html();
        var Trimid=$("#cartypel").parent().find("p").attr("id");//车型编号id
        var CITY=$('#indentical p').html();//上牌地区
        var MILE=$('#run').val();//公里
        $.post('assess_assess.json',
            {'Trimid':Trimid,'CITY':CITY,'MILE':MILE}//将显示的条数当参数传入，以后查询carinfo的方法，尽量当用这个后台，后台可继续改造
            ,function(data){
                //alert(data);
                // {"mid_pricemin":"11.93","mid_pricemiddle":"11.36","mid_pricemax":"10.79","guided_pricem":"21.39"}
                var mid_pricemin=data.mid_pricemin;
                var mid_pricemiddle=data.mid_pricemiddle;
                var mid_pricemax=data.mid_pricemax;
                var guided_pricem=data.guided_pricem;
                var now_pric=mid_pricemax.substring(0,mid_pricemax.length-1);
                $("#nowprice").text(mid_pricemax);
                $("#minprice").text(mid_pricemin);
                $("#middleprice").text(mid_pricemiddle);
                $("#maxprice").text(mid_pricemax);
                /*   $("#newprice").text(guided_pricem+"万");*/
                $("#newprice").text(guided_pricem);
                // alert(data.mid_pricemin);

            }

            ,"json");
        //alert($("#minprice").text());
        //location.href="assess_assess";
        subtitle1();
        $(".w_ment").css("display","none");
        $(".n_ment").css("display","block");
        return true;
    }
    return  false;
}
//小字显示的信息
function subtitle1(){
    var Trimid=$("#cartypel").parent().find("p").text();
    var time="上牌时间:"+$("#year p").text()+"年"+$("#month p").text();
    var MILE="公里数:"+$('#run').val()+"万公里" ;
    var CITY="地区:"+$('#indentical p').html();
    //		alert(time);
    $('#kuan1').attr("title",Trimid);
    $('#kuan1').text(Trimid);
    $('#kuan2').text(time);
    $('#kuan3').text(MILE);
    $('#kuan4').text(CITY);
//
}
//实现年月日下拉
function year1(){
    var yearid = $('#years') ;   //年所在的控件
    var monthid = $('#months');   //月所在的控件
    yearid.empty();
    monthid.empty();

    var myDate = new Date();
    var year = myDate.getFullYear();
    /* for(var i=0;i<=100;i++){
     <li><a href="javascript:;">2015</a></li>

     yearid.append('<li ><a href="javascript:;">'+year+'</a></li>');
     year--;
     }*/

    for(var i=year; i>=2008 ; i--){
        yearid.append('<li ><a href="javascript:;">'+i+'</a></li>');
    }
    for(var i=1;i<=12;i++){
        monthid.append('<li><a href="javascript:;">'+i+"月</a></li>");

    }
//         控制显示
    $("#months li a").click(function(){
        _smq.push(['custom','pc/选择上牌月份__主视觉','选择上牌月份',new Date()]);

        var _this = $(this);
        var txt = _this.html();
        if(txt=="上牌月份"){

            $('#pcmonths').html('<span><img src="'+path+'/images/manage/prompt.png"></span>请选择月份');
        }else{
            $('#pcmonths').css('display','none');
            /*$('#pcmonths').html("");*/
        }

        _this.parent().parent().parent().find("p").html(txt);
        _this.parent().parent().parent().removeClass('selected active');
    });
    //控制显示
    $("#years li a").click(function(){
        _smq.push(['custom','pc/选择上牌年份__主视觉','选择上牌年份',new Date()]);

        var _this = $(this);
        var txt = _this.html();
        if(txt=="上牌年份"){

            $('#pcyear').html('<span><img src="'+path+'/images/manage/prompt.png"></span>请选择年份');
        }else{
            $('#pcyear').css('display','none');
            /*$('#pcyear').html("");*/
        }

        _this.parent().parent().parent().find("p").html(txt);
        _this.parent().parent().parent().removeClass('selected active');
    });
}


//小字显示的信息


function changecity(name){

    location.href=path+"/assess_init?ci_ciArea="+name;
}

//价格显示判断
function getjudge(){
    var pinpai=$("#pinpai").find("p").html();
    var chanshang = $("#chanshang").find("p").html();
    var chexi=$(".select_2").find("p").html();

    var chexing=$(".select_3").find("p").html();

    var yearpc= $('#year').find("p").html();
    var monthpc=$('#month').find("p").html();
    var pcegionpc= $('#indentical').find("p").html();
    var runpc =$('#run').val();
    var regpc = /^(([1-9]+)|([1-9][0-9]+)|([0-9]+\.[0-9]{1,2}))$/;
    $('#nochang').css("display","none");
    if(chanshang == "厂商"){
        $('#nochang').css("display","block");
        $('#nochang').html('<span><img src="'+path+'/images/manage/prompt.png"></span>请选择厂商');
        return false;
    } if(pinpai=="现有车辆品牌"){
        $('#pccar').addClass("first");
        $('#brandcar').css("display","block");
        $('#brandcar').html('<span><img src="'+path+'/images/manage/prompt.png"></span>请选择车辆品牌');
        return false;
    } if(chexi=="请选择车系"){
        $('#pccar').css("display","block");
        /*$('#pccar').addClass("first");*/

        $('#pccar').html('<span><img src="'+path+'/images/manage/prompt.png"></span>请选择车系');
        return false;
    }if(chexing=="请选择车型"){
        $('#pcModels').css("display","block");
        /*$('#pcModels').addClass("first");*/

        $('#pcModels').html('<span><img src="'+path+'/images/manage/prompt.png"></span>请选择车型');
        return false;
    }if(yearpc=="上牌年份"){
        $('#pcyear').css("display","block");
        /*	$('#pcyear').addClass("first");*/

        $('#pcyear').html('<span><img src="'+path+'/images/manage/prompt.png"></span>请选择年份');
        return false;
    }if(monthpc=="上牌月份"){
        $('#pcmonths').css("display","block");
        /*$('#pcmonths').addClass("first");*/

        $('#pcmonths').html('<span><img src="'+path+'/images/manage/prompt.png"></span>请选择月份');
        return false;
    }if(pcegionpc=="上牌地区"){
        $('#pcdiqu').css("display","block");
        /*	$('#pcdiqu').addClass("first");*/
        $('#pcdiqu').html('<span><img src="'+path+'/images/manage/prompt.png"></span>请选择地区');
        return false;
    }if(runpc==""){
        $('#pcrun').css("display","block");
        /*	$('#pcrun').addClass("first");*/

        $('#pcrun').html('<span><img src="'+path+'/images/manage/prompt.png"></span>请填写行驶里程');
        return false;
    }if(!regpc.test(runpc) || parseInt(runpc) < parseInt(0) || runpc=="0.00" || runpc=="0.0"){
        $('#pcrun').css("display","block");
        /*	$('#pcrun').addClass("first");*/
        $('#pcrun').html('<span><img src="'+path+'/images/manage/prompt.png"></span>行驶里程格式不正确');
        return false;
    }if(parseInt(runpc) >parseInt(100)){
        $('#pcrun').css("display","block");
        $('#pcrun').html('<span><img src="'+path+'/images/manage/prompt.png"></span>行驶里程大于100万公里');
        return false;
    }else{
        return true;
    }

}

// 页面调取
//活动标题
function gotitle(type){

    if(type==1){

        _smq.push(['custom','pc/二手车评估活动__主视觉','$普通活动名称',new Date()]);
    };
    if(type==2){

        _smq.push(['custom','pc/二手车评估活动__主视觉','$团购活动名称',new Date()]);

    };
    if(type==3){
        _smq.push(['custom','pc/二手车评估活动__主视觉','$代金券活动名称',new Date()]);
    };

};

//活动商家
function godeal(type){
    if(type==1){
        _smq.push(['custom','pc/二手车评估活动__主视觉','$普通活动商家',new Date()]);

    };
    if(type==2){

        _smq.push(['custom','pc/二手车评估活动__主视觉','$团购活动商家',new Date()]);

    };
    if(type==3){
        _smq.push(['custom','pc/二手车评估活动__主视觉','$代金卷活动商家',new Date()]);

    };

};

//点击查看或点击购买
function gomai(type){
    if(type==1){

        _smq.push(['custom','pc/二手车评估活动__主视觉','$点击查看',new Date()]);
    };
    if(type==2){

        _smq.push(['custom','pc/二手车评估活动__主视觉','$立即购买',new Date()]);

    };
    if(type==3){
        _smq.push(['custom','pc/二手车评估活动__主视觉','$立即购买',new Date()]);


    };

};

//查询车辆品牌
function ckbrand(pid){
    //查看厂商是否选中
    ckchang();
    $('#nochang').css("display","none");
    $.ajax({
        type: "POST",
        url: path+"/getclppai",
        data:{"cd_pid":pid},
        //async: false,//设置同步提交，这样可以将值返回
        dataType: "json",
        success:function(data){
            $("#cheliandata").empty();
            var html ='';
            //var carid="";
            //var old = 'YU';
            if(data.length<=0){
                html +="<li>暂无车辆信息</li>";
            }
            for(var i = 0 ; i < data.length;i++){
//	        		if(old.trim() != data[i].cd_standby2.trim()){
//	        			html += '<li class="zm" id="'+data[i].cd_standby2+'">'+data[i].cd_standby2+'</li>';
//	        			carid +='<a href="javascript:;" onclick="ozselect(this)">'+data[i].cd_standby2+'</a>';
//	        		}
                html+='<li><a href="javascript:;" id="'+data[i].cd_cid+'" value="'+data[i].cd_cnname+'" onclick="ck(this)">'+data[i].cd_cnname+'</a></li>';

                old = data[i].cd_standby2;
            }
            //	html += '</ul>';
            //$("#carid").html(carid);
            $("#cheliandata").append(html);
            //
            $("#cheliandata li a").click(function(){
                _smq.push(['custom','pc/选择车系__主视觉','选择厂商',new Date()]);
                $('#nochang').css("display","none");
                var _this = $(this);
                var txt = _this.html();
                _this.parent().parent().parent().find("p").html(txt);
                _this.parent().parent().parent().removeClass('selected active');
            });
        }
    });
}


var MD=['A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z'];

function  dealerCity () {

    /*     var number=dcity[0];//获取id
     var name=dcity[1];//获取字母与名称
     name=name.split(" "); //分割空格 获取字母与名称的数组
     if(zm[i]==name[0]){

     if(num<1){
     $("#dealerCityList").append("<dl><dt>"+name[0]+"</dt><dd><span><a href='"+path+"sk?curcity="+number+ "' >"+name[1]+"</a></span></dd></dl>");
     }else{
     $("#dealerCityList dl:last dd:last").append("<span><a href='"+path+"sk?curcity="+number+ "' >"+name[1]+"</a></span>");

     }
     num=num+1;
     }*/









    $("#dealerCityList").empty();//由于切换是ajax不刷新页面所以，在更新车辆时得清空下
    $.ajax({
        type: "POST",  //提交方式
        url: path + "/openCities",//路径
        success:function(result){
            var json = $.parseJSON(result);
            if (json == null || json.msg == null || json.msg == undefined) {

            }else{
                var data = eval(json.msg);

                for ( var i = 0; i < MD.length; i++) {
                    //循环zm 由于dcitys里的顺序本身就是按照abcd来排序的所以不需要逐个和zm里的ABCD进行比对，只需要按照zm的顺序循环比对即可
                    var num=0;//定义num来判断zm和dcity中的字母是否匹配
                    for ( var j = 0; j < data.length; j++) {
                        if(j>=0){
                            var dcity=data[j];//获取每一个dcity对象
                            var name =    dcity.CNNAME;
                            var number =    dcity.CID;
                            var name2 =  dcity.STANDBY2;
                            if(MD[i]==name2){
                                if(num<0){
                                    $("#dealerCityList").append("<dl><dt>"+name2+"</dt><dd><span><a id='actl"+number+"' onclick='selectDealerCode("+number+")' href='javascript:;' >"+name+"</a></span></dd></dl>");

                                }else{
                                    $("#dealerCityList dl:last dd:last").append("<span><a hid='actl"+number+"' onclick='selectDealerCode("+number+")' href='javascript:;' >"+name+"</a></span>");

                                }
                                num=num+1;
                            }
                        }
                    }
                }
                /* var div="";
                 for(var i in data){
                 var obj=data[i];
                 if(i==0){
                 div+="<li class='first'><a id='actl"+obj.CID+"' onclick='selectDealerCode("+obj.CID+")' href='javascript:;'>"+obj.CNNAME+"</a></li>";
                 }else{
                 div+="<li><a id='actl"+obj.CID+"' onclick='selectDealerCode("+obj.CID+")' href='javascript:;'>"+obj.CNNAME+"</a></li>";
                 }
                 }
                 $("#dealerCityList").append(div);*/
            }
        }

    });
}

var arryCode = new Array();
function  selectDealerCode (ctiyId) {
    // arryCode.empty();
    arryCode =new Array();
    $("#dealerCodeList").empty();
    $("#dealerCode").find("p").text('经销商');
    $("#dealerCode").find("p").attr("id","");
    $.ajax({
        type: "POST",  //提交方式
        url: path + "/findDealerCodeByCityId",//路径
        data:{"dd_city":ctiyId},
        success:function(result){
            var json = $.parseJSON(result);
            if (json == null) {

            }else{
                var div="";
                for(var i in json){
                    var obj=json[i];
                    if(i==0){
                        div+="<li class='first'><a id='actl"+obj.AD_DEALER_CODE+"' onblur='checkDealerCodes();'  onclick='setDealerCodes(0,this.id)' href='javascript:;'>"+obj.SHOP_HOME_NICK+"</a></li>";
                        arryCode.push(obj.AD_DEALER_CODE);
                    }else{
                        div+="<li><a id='actl"+obj.AD_DEALER_CODE+"' onblur='checkDealerCodes();' onclick='setDealerCodes("+i+",this.id)' href='javascript:;'>"+obj.SHOP_HOME_NICK+"</a></li>";
                        arryCode.push(obj.AD_DEALER_CODE);
                    }
                }
                $("#dealerCodeList").append(div);
            }
        }

    });
    $("#dealerCityList li a").click(function(){
        var _this = $(this);
        var txt = _this.html();
        _this.parent().parent().parent().find("p").html(txt);
        _this.parent().parent().parent().removeClass('selected active');
    });
}



function  setDealerCodes (dealerCodeIndex,obj) {
    $("#invoice_code").val(arryCode[dealerCodeIndex]);
    /*
     $("#dealerCodeList li a").click(function(){*/

    var _this = $("#"+obj);
    var txt = _this.html();
    _this.parent().parent().parent().find("p").html(txt);
    _this.parent().parent().parent().removeClass('selected active');
    /*
     });
     */

}
function submitdoCumentCode(){
    if(!checkName()||!checkAssPhone()||!checkDealerCode()){
        return ;
    }
    var userName = $("#user_name").val();
    var userPhone=$("#user_phone").val();
    var dealerCode = $("#invoice_code").val();
    $.ajax({
        type: "POST",  //提交方式
        url: path + "/onlineOrderAsseInfo_add",//路径
        data:{"user_name":userName,"user_phone":userPhone,"invoice_code":dealerCode},
        success:function(data){
            var json = $.parseJSON(data);
            if(1==json.errorCode){
                $('#grabAlert1').attr('style','display:block');
                $('#background_Black').attr('style','display:block');
                $('.close1').click(function () {
                    $('#grabAlert1').attr('style','display:none');
                    $('#background_Black').attr('style','display:none');
                    window.location.reload();
                })
            }else{
                $('#grabAlert1').attr('style','display:block');
                $('#background_Black').attr('style','display:block');
                $('.close1').click(function () {
                    $('#grabAlert1').attr('style','display:none');
                    $('#background_Black').attr('style','display:none');
                    window.location.reload();
                })
            }
        }
    });
}


function  checkName() {
    if($("#user_name").val()==""){
        $('#pcrunName').css("display","block");
        return false ;
    }else{
        $('#pcrunName').css('display','none');
        return true;
    }

}

function  checkAssPhone() {
    if($("#user_phone").val()==""){
        $('#pcrunPhone').css("display","block");
        return false;
    }else{
        if(checkAssPhoneE()){
            $("#pcrunPhone").css('display','none');
            return true;
        }else{
            $("#pcrunPhone").css('display','block');
            return false;
        }
        // $('#pcrunPhone').css('display','none');
    }

}


function  checkDealerCode() {
    var  dealerp =  $("#dealerCode").find("p").text();
    if("经销商"==dealerp||""==dealerp){
        $("#pcDealerCode").css('display','block');
        return false;
    }else{
        $("#pcDealerCode").css('display','none');
        return true;
    }
}

function checkAssPhoneE() {
    var phone =  $('[name="user_phone"]').val();
    if (!(/^1[34578]\d{9}$/.test(phone))) {
        return false;
    }
    return true;
}

function  checkNames() {
    if($("#user_name").val()==""){
        // $('#pcrunName').css("display","block");
        return false ;
    }else{
        $('#pcrunName').css('display','none');
        return true;
    }

}

function  checkAssPhones() {
    if($("#user_phone").val()==""){
        // $('#pcrunPhone').css("display","block");
        return false;
    }else{
        if(checkAssPhoneE()){
            $("#pcrunPhone").css('display','none');
            return true;
        }else{
            // $("#pcrunPhone").css('display','block');
            return false;
        }
        $('#pcrunPhone').css('display','none');
    }

}

function  checkDealerCodes() {
    var  dealerp =  $("#dealerCode").find("p").text();
    if("经销商"==dealerp||""==dealerp){
        // $("#pcDealerCode").css('display','block');
        return false;
    }else{
        $("#pcDealerCode").css('display','none');
        return true;
    }
}

