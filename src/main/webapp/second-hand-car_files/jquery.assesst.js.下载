var po,previd,isCityList=false;
var dftCity = "dftCity";
$(function(){
	$("#city-down a.cur").attr("id",dftCity);

	
	$(".sort-wrap").click(function(){
		return false;	
	});
	$(".sort-list li").click(function(){
		var type = $(this).attr("type");
		if($(this).hasClass("cur")){
			$(".sort-list li").removeClass("cur");
			previd = '';
			$("."+type).fadeOut();
			//$(document).unbind("click");
		}else{
			$(".sort-list li").removeClass("cur");
			$(this).addClass("cur");
			
			
			if(previd==type){
				return false;	
			}
			if(previd!=''){
				$("."+previd).fadeOut();
			}
			$("."+type).fadeIn();
			if(!isCityList && type=='select-city'){
				isCityList = true;
				var myCityList = new IScroll('#city-down', {
					scrollbars: true,
					mouseWheel: true,
					interactiveScrollbars: true,
					shrinkScrollbars: 'scale',
					fadeScrollbars: true,
					click: true
				});
			}
			po = $(this);
			previd = type;
			
			$(document).unbind("click");
			$(document).bind("click",function(){
				$("."+previd).fadeOut();
				previd = '';
				$(this).unbind("click");
				$(".sort-list li").removeClass("cur");
			});
		}
		$(".select-more .select").removeClass("cur");
		return false;
	});
	
	if("ontouchend" in document){
		if($(".sort-list").size()>0){
			$(".sort-list").addClass("sort-touch");
		}
	}
	
	$(window).bind("scroll",function(){
		if($(".select-city").is(":visible")){
			$(document).click();
		}	
		if($(".select-type").is(":visible")){
			$(document).click();
		}	

		// var top = $(".sort").offset().top;
		
		if($(window).scrollTop() >= top){
			if(!$(".sort-position").hasClass("sort-position-cur")){
				$(".sort-position").addClass("sort-position-cur");
			}
		}else{
			if($(".sort-position").hasClass("sort-position-cur")){
				$(".sort-position").removeClass("sort-position-cur");
			}
		}
		
	}).bind("resize",function(){
		resetSortHeight();
	});
	resetSortHeight();

});

//筛选 城市
function changeCity(obj){
	var txt = $(obj).html();
	$("#down-city .df").css({color:'#c03'});
	$("#down-city .df").html(txt);	
	$("."+previd).fadeOut();
	previd = '';
	
	$(".sort-list li").removeClass("cur");
	$(".city-list a").removeClass("cur");
	obj.className = "cur";
	
	$(".select-city").fadeOut();
}
//筛选 车型
function changeType(obj){
	var txt = $(obj).html();
	$("#down-type .df").html(txt);	
	$("."+previd).fadeOut();
	previd = '';
	if(txt!=$(".type-list li").eq(0).text()){
		$("#down-type .df").css({color:'#c03'});
	}else{
		$("#down-type .df").removeAttr("style");
	}
	
	$(".sort-list li").removeClass("cur");
}

function resetSortHeight(){
	$(".sort").height($(".sort-position").height());
}
// select下拉
$(function(){
    $(".w_ment p").click(function() {
    	$(this).parent().siblings().removeClass('selected');
        $(this).parent().toggleClass('selected');
    });
    $(".w_ment .type-down").click(function() {
        $(this).parent().removeClass('selected');
    });
    $(document).bind("click",function(e){ 
		var target = $(e.target); 
		if(target.closest(".select").length == 0){ 
		   $(".select").removeClass('selected');
		} 
	});
	$(".oz a").click(function(){
		var o = $(this).text();
		$(this).parents(".select").find(".type-down.type-down-oz ul").scrollTop(0);
		var t = ($(this).parents(".select").find("#"+o).offset().top -$(this).parent().offset().top);
		$(this).parents(".select").find(".type-down.type-down-oz ul").scrollTop(t);

		return false;
	});
}); 
function ozselect(obj){
	
	var o = $(obj).text();
	$(obj).parents(".select").find(".type-down.type-down-oz ul").scrollTop(0);
	var t = ($(obj).parents(".select").find("#"+o).offset().top -$(obj).parent().offset().top);
	$(obj).parents(".select").find(".type-down.type-down-oz ul").scrollTop(t);

	return false;
}


// 价格切换
$(function(){
    $("a.tabs_z").click(function() {
    	$(this).siblings().removeClass('active');
        $(this).addClass('active');
    });  
    $(".w_ment .btn").click(function() {
        //$(".w_ment").css("display","none");
        //$(".n_ment").css("display","block");
    });
	$('a.tabs_z1').click(function(){
		$(".span_1").addClass('active');
        $(".span_2,.span_3").removeClass('active');
	    var html = $('.span_1 .obtain').html();
	    $('.r span').html("").append(html);
	    var str = $(".r span").text().substr(0,4);
	    $('.r span').text(str);
	}); 
	$('a.tabs_z2').click(function(){
		$(".span_2").addClass('active');
        $(".span_1,.span_3").removeClass('active');
	    var html = $('.span_2 .obtain').html();
	    $('.r span').html("").append(html);
	    var str = $(".r span").text().substr(0,4);
	    $('.r span').text(str);
	});
	$('a.tabs_z3').click(function(){
		$(".span_3").addClass('active');
        $(".span_1,.span_2").removeClass('active');
	    var html = $('.span_3 .obtain').html();
	    $('.r span').html("").append(html);
	    var str = $(".r span").text().substr(0,4);
	    $('.r span').text(str);
	});
}); 




