var zm = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'];
var browser = {
    versions: function () {
        var u = navigator.userAgent, app = navigator.appVersion;
        return {
            trident: u.indexOf('Trident') > -1, // IE
            presto: u.indexOf('Presto') > -1, // opera
            webKit: u.indexOf('AppleWebKit') > -1, // Apple or Chrome
            gecko: u.indexOf('Gecko') > -1 && u.indexOf('KHTML') == -1, // Firfox
            mobile: !!u.match(/AppleWebKit.*Mobile/)
            || !!u.match(/Windows Phone/) || !!u.match(/Android/)
            || !!u.match(/MQQBrowser/), // mobile
            ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), // ios
            android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, // android
            iPhone: u.indexOf('iPhone') > -1, // iPhone or QQHD
            iPad: u.indexOf('iPad') > -1, // iPad
            webApp: u.indexOf('Safari') == -1
        };
    }()
};
$(function () {
    var width = $('.fixed-background '). width();
    var height = Math.floor(width/538*207)+"px";
    $('.fixed-background ').css("min-height",height);
    $('.focus-getmore').css("min-height",height);
    var cookiecity = $.cookie('cookiecity');
    var cityname = $.cookie('cityname');
    var c = decodeURI(cityname);
    /*定位信息来源cityLocationType后台定义值
     手动切换：from_choice
     cookie保存：from_cookie
     后台ip定位的：from_session
     百度定位：from_baidu
     百度定位：fail
     */
    var cityLocationType = $("#cityLocationType").val();
    //  判断浏览器是否有城市定位信息
    if (cookiecity == null || cookiecity == '') {
        window.onload = getLocation(successFunc, errorFunc);
    } else {
        $(function () {
            $("#area").html(c);
            $("#selectcity").text(c);
            notkaitongcity("area");
        });
        initTodayFocus();
        initDom();
    }
    $("#searchtj a").on("click", function () {
        var tj = $(this).html();
        txt = encodeURI(encodeURI(tj));
        location.href = path + "/search?type=c&query=" + txt;
    });
});
var successFunc = function (bdcitycode,curType) {
    $.ajax({
        url: path + "/getCityId",
        data: "bdcitycode=" + bdcitycode,
        type: "post",
        async: false,
        success:function(res){
            var resultJson = $.parseJSON(res);
            //百度定位信息与后台ip定位结果不一致，重新加载
            if(resultJson.reload == "yes"){
                console.log("定位不一致，百度为准，重新加载");
                window.location.href=window.location.href+"?id="+10000*Math.random();
            }else{
                console.log("不重新加载，做是否有经销商判断处理");
                $("#area").html(resultJson.cityName);
                $("#selectcity").text(resultJson.cityName);
                notkaitongcity("area");
            }
        }
    });
};
var errorFunc = function (error) {
    alert(error);
    $.ajax({
        type: "POST",  //提交方式
        url: path + "/backhave",//路径
        data: {
            "dd_city": null
        },//数据，这里使用的是Json格式进行传输
        success: function (result) {//返回数据根据结果进行相应的处理
            var json = $.parseJSON(result);
            if (json == null || json.msg == null || json.msg == undefined) {
            } else {
                var obj = eval(json.msg);
                $(".toggle-city-fy").css('display', 'block');
                $(".toggle-city-fy .ty-list").empty();//清空原list
                initCity(obj);
            }
        }
    });
};
var geoSuccess = function (event) {
    var mycity = new BMap.LocalCity();
    mycity.get(function (result) {
        var bdcitycode = result.code;
        var cityname = result.name;
        // alert("当前定位城市:"+bdcitycode+"|"+cityname);
        if (successFunc != undefined) {
            successFunc(bdcitycode);
        }
    });
};
var geoError = function (event) {
    if (errorFunc != undefined) {
        errorFunc("获取定位失败，请手动定位城市。");
    }
};
var getLocation = function (successFunc, errorFunc) { //successFunc获取定位成功回调函数，errorFunc获取定位失败回调
    //默认城市
    var mycity = new BMap.LocalCity();
    mycity.get(function (result) {
        var bdcitycode = result.code;
        var cityname = result.name;
        // bdcitycode = 132;
        // alert("当前定位城市:"+bdcitycode+"|"+cityname);
        if(bdcitycode != null){
            if (successFunc != undefined) {
                successFunc(bdcitycode);
            }
        }else{
            if (errorFunc != undefined) {
                errorFunc("获取定位失败，请手动定位城市。");
            }
        }
    });
    // if (navigator.geolocation) {
    //     var option = {
    //         enableHighAccuracy: true,
    //         timeout: Infinity,
    //         maximumAge: 0
    //     }
    //     navigator.geolocation.getCurrentPosition(this.geoSuccess, this.geoError, option)
    // }else{
    //     if (errorFunc != undefined) {
    //         errorFunc("你的浏览器不支持获取地理位置信息，请手动定位城市。");
    //     }
    // }
    // var geolocation = new BMap.Geolocation();
    // if (geolocation) {
    //     geolocation.getCurrentPosition(function (position) {
    //         alert('position.accuracy:'+position.accuracy);
    //         if (this.getStatus() == 0) {
    //             var mycity = new BMap.LocalCity();
    //             mycity.get(function (result) {
    //                 var bdcitycode = result.code;
    //                 var cityname = result.name;
    //                 // alert("当前定位城市:"+bdcitycode+"|"+cityname);
    //                 if (successFunc != undefined) {
    //                     successFunc(bdcitycode);
    //                 }
    //             });
    //         } else {
    //             //关于状态码
    //             //BMAP_STATUS_SUCCESS   检索成功。对应数值“0”。
    //             //BMAP_STATUS_CITY_LIST 城市列表。对应数值“1”。
    //             //BMAP_STATUS_UNKNOWN_LOCATION  位置结果未知。对应数值“2”。
    //             //BMAP_STATUS_UNKNOWN_ROUTE 导航结果未知。对应数值“3”。
    //             //BMAP_STATUS_INVALID_KEY   非法密钥。对应数值“4”。
    //             //BMAP_STATUS_INVALID_REQUEST   非法请求。对应数值“5”。
    //             //BMAP_STATUS_PERMISSION_DENIED 没有权限。对应数值“6”。(自 1.1 新增)
    //             //BMAP_STATUS_SERVICE_UNAVAILABLE   服务不可用。对应数值“7”。(自 1.1 新增)
    //             //BMAP_STATUS_TIMEOUT   超时。对应数值“8”。(自 1.1 新增)
    //             switch (this.getStatus()) {
    //                 case 2:
    //                     alert('位置结果未知 获取位置失败.');
    //                     break;
    //                 case 3:
    //                     alert('导航结果未知 获取位置失败..');
    //                     break;
    //                 case 4:
    //                     alert('非法密钥 获取位置失败.');
    //                     break;
    //                 case 5:
    //                     alert('对不起,非法请求位置  获取位置失败.');
    //                     break;
    //                 case 6:
    //                     alert('对不起,当前 没有权限 获取位置失败.');
    //                     break;
    //                 case 7:
    //                     alert('对不起,服务不可用 获取位置失败.');
    //                     break;
    //                 case 8:
    //                     alert('对不起,请求超时 获取位置失败.');
    //                     break;
    //
    //             }
    //             //默认城市
    //             if (errorFunc != undefined) {
    //                 errorFunc("获取定位失败，请手动定位城市。");
    //             }
    //         }
    //     }, {timeout: 5000, enableHighAccuracy: true});
    // } else {
    //     if (errorFunc != undefined) {
    //         errorFunc("你的浏览器不支持获取地理位置信息，请手动定位城市。");
    //     }
    // }
};

function initTodayFocus() {
    $.get(path+"/article/jsonTodayFocuses?page=1&pageSize=6&withLink=1",function (result) {
        result = JSON.parse(result);
        // console.log(result);
        var detailUrl =  path + "/article/viewTodayFocus?tf_id=";
        var hasIndexLink = false;
        if (result.linkTodayFocus) {
            hasIndexLink = true;
            $("#indexTodayFocusLink").attr("href",detailUrl + result.linkTodayFocus.tf_id);
        }
        var data = result.todayFocusList;
        $("#todayFocusList").empty();
        for(var i=0;i<Math.min(5,data.length);i++){
            var url = detailUrl + data[i].tf_id;
            var div = '<li><a href="'+ url +'" target="_blank">'+ '<div class="dot"></div>'+ data[i].tf_title +'</a></li>';
            if(data[i].tf_is_link == 1 && !hasIndexLink){//如果没有设置图片链接，默认链接最新发布的文章
                $("#indexTodayFocusLink").attr("href",url);
            }
            $("#todayFocusList").append(div);
        }
    });
}



// 未开通经销商城市处理
function notkaitongcity(idstr) {
    var stringid = $("#" + idstr).attr("citynameid");
    $.ajax({
        type: "POST",  //提交方式
        url: path + "/backhave",//路径
        data: {
            "dd_city": stringid
        },//数据，这里使用的是Json格式进行传输
        success: function (result) {//返回数据根据结果进行相应的处理
            var json = $.parseJSON(result);
            if (json != null && json.msg != null && json.msg != undefined) {
                var obj = eval(json.msg);
                $(".toggle-city-fy").css('display', 'block');
                $(".toggle-city-fy .ty-list").empty();//清空原list
                initCity(obj);
            }
        }
    });
}

// 获取开通经销商城市信息
function getDealercityList() {
    $(".list").empty();//清空原list
    $.ajax({
        type: "POST",  //提交方式
        url: path + "/openCities",//路径
        success: function (result) {//返回数据根据结果进行相应的处理
            var json = $.parseJSON(result);
            if (json == null || json.msg == null || json.msg == undefined) {

            } else {
                var obj = eval(json.msg);
                for (var i = 0; i < zm.length; i++) {//循环zm 由于dcitys里的顺序本身就是按照abcd来排序的所以不需要逐个和zm里的ABCD进行比对，只需要按照zm的顺序循环比对即可
                    var num = 0;//定义num来判断zm和dcity中的字母是否匹配
                    for (var j = 0; j < obj.length; j++) {
                        if (j >= 0) {
                            var dcity = obj[j];//获取每一个dcity对象
                            var number = dcity.CID;//获取id
                            var name = dcity.REMARK;//获取字母与名称
                            name = name.split(" "); //分割空格 获取字母与名称的数组
                            if (zm[i] == name[0]) {//如果zm与dcity的字母相同则把对应的信息拼接出来，如果没有相同的则dd不显示对应zm里的字母。
                                if (num < 1) {
                                    //如果在相同zm里，第一次进入则拼接dl
                                    $(".list").append("<dl><dt>" + name[0] + "</dt><dd><span><a href='#' onclick=changecity('" + number + "')>" + name[1] + "</a></span></dd></dl>");
                                } else {
                                    //如果在相同zm里已经有dl则直接在dd里面拼接span
                                    $(".list dl:last dd:last").append("<span><a href='#' onclick=changecity('" + number + "')>" + name[1] + "</a></span>");
                                }
                                num = num + 1;
                            }
                        }
                    }
                }
            }
        }
    });
}

//本地最新车辆查询
function findNewestCar(strat, end, address) {
    $.post('findNewestCar.json', {'start': strat, 'end': end, 'changecity': address}//将显示的条数当参数传入，以后查询carinfo的方法，尽量当用这个后台，后台可继续改造
        , function (data) {
            var result = eval(data);
            $("#zuixin").empty();//由于切换是ajax不刷新页面所以，在更新车辆时得清空下
            var div = "";
            // div += "<div class='item fast item_w' id='zuixinfirst'>";
            // div += "<a class='hb'>";
            // div += "<div class='mi'>";
            // div += "<p class='name'>最新车源</p>";
            // div += "<p>精选放心车源，闪耀开启便捷之旅</p>";
            // div += "</div>";
            // div += "<img src='" + path + "/images/temp1.jpg'/></a>";
            // div += "</div>";
            //追加固定的第一个。
            if (result == null || result == '') {
                div += "<div><h2>本地暂无车型</h2></div>";
                $("#zuixin").append(div);
            } else {
                $("#zuixin").append(div);
            }
            for (var i in result) {
                var obj = result[i];
                var div = "";
                if (i == 0) {
                    div += "<div class='item fast-m item_w' id='item fast-m item_w'>";
                } else {
                    div += "<div class='item item_w' id='item item_w'>";
                }
                //<a href='#'><img src='"+path+"/'"+obj.cad_file_path+".'"+obj.cad_cadFileExtensionName+"' /></a>
                div += "<div class='image'><a href='" + path + "/detail/" + obj.ci_ciReleaseNumber + ".html' target='_blank'><img src='" + imgpath + "/" + obj.cad_file_path + "." + obj.cad_cadFileExtensionName + "'  class='zuixincarimg'/></a></div>";
                div += "<div class='info' id='zuixin'>";
                if (obj.ci_ciCarModel != null && obj.ci_ciCarAir != null) {
                    div += "<a href='" + path + "/detail/" + obj.ci_ciReleaseNumber + ".html' class='b-url' title='" + obj.ci_ciModelLine + " " + obj.ci_ciCarModel + " " + obj.ci_ciCarAir + " " + obj.ci_ciTransmission + " " + obj.ci_ciModelName + "'target='_blank'></a>";
                } else {
                    div += "<a href='" + path + "/detail/" + obj.ci_ciReleaseNumber + ".html' class='b-url' title='" + obj.ci_ciModelLine + " " + obj.ci_ciTransmission + " " + obj.ci_ciModelName + "'target='_blank'></a>";
                }
                if (obj.ci_ciCarModel != null && obj.ci_ciCarAir != null) {
                    div += "<h3>" + obj.ci_ciModelLine + " " + obj.ci_ciCarModel + " " + obj.ci_ciCarAir + " " + obj.ci_ciTransmission + " " + obj.ci_ciModelName + "</h3>";
                } else {
                    div += "<h3>" + obj.ci_ciModelLine + " " + obj.ci_ciTransmission + " " + obj.ci_ciModelName + "</h3>";
                }
                div += "<p>上牌" + obj.ci_ciRegistration.substring(0, 4) + " | " + obj.ci_ciMileage + "万公里 | " + obj.ci_ciArea + "</p>";
                div += "<p class='price'>RMB:" + obj.ci_ciPrice + "</p>";
                if (obj.dd_shopHomeNick != null && obj.dd_shopHomeNick != '') {
                    div += "<p><a href='" + path + "/dealer/home/" + obj.ci_ciLoginId + ".html' class='s-url' title='" + obj.dd_shopHomeNick + "' target='_blank'>" + obj.dd_shopHomeNick + " </a> <span class='icon-gold'></span></p>";
                }

                /*div+="<p>0首付 低月供 即刻拥有</p>";*/
                div += "</div>";
                div += "</div>";
                $("#zuixin").append(div);
            }
        }, "json");
}
/*//推荐车型查询
 function findAdviceCar(strat, end) {
 $.post('findAdviceCar.json', {'start': strat, 'end': end}//将显示的条数当参数传入，以后查询carinfo的方法，尽量当用这个后台，后台可继续改造
 , function (data) {
 var result = eval(data);
 $("#tuijian").empty();//由于切换是ajax不刷新页面所以，在更新车辆时得清空下
 var div = "";
 div += "<div class='item fast item_w' id='zuixinfirst'>";
 div += "<a class='hb'>";
 div += "<div class='mi'>";
 div += "<p class='name'>推荐车源</p>";
 div += "<p>量身专属，为成功添注源动力</p>";
 div += "</div>";
 div += "<img src='" + path + "/images/temp1.jpg' /></a>";
 div += "</div>";
 if (result == null || result == '') {
 div += "<div><h2>本地暂无车型</h2></div>";
 $("#tuijian").append(div);
 } else {
 $("#tuijian").append(div);
 }
 for (var i in result) {
 var obj = result[i];
 var div = "";
 if (i == 0) {
 div += "<div class='item fast-m item_w' id='item fast-m item_w'>";
 } else {
 div += "<div class='item item_w' id='item item_w'>";
 }

 div += "<div class='image'><a href='" + path + "/detail/" + obj.ci_ciReleaseNumber + ".html' target='_blank'><img src='" + imgpath + "/" + obj.cad_file_path + "." + obj.cad_cadFileExtensionName + "' class='carimg'/></a></div>";
 div += "<div class='info' id='tianjian'>";
 if (obj.ci_ciCarModel != null && obj.ci_ciCarAir != null) {
 div += "<a href='" + path + "/detail/" + obj.ci_ciReleaseNumber + ".html'target='_blank' class='b-url' title='" + obj.ci_ciModelLine + " " + obj.ci_ciCarModel + " " + obj.ci_ciCarAir + " " + obj.ci_ciTransmission + " " + obj.ci_ciModelName + "' ></a>";
 }
 else {
 div += "<a href='" + path + "/detail/" + obj.ci_ciReleaseNumber + ".html' target='_blank' class='b-url' title='" + obj.ci_ciModelLine + " " + obj.ci_ciTransmission + " " + obj.ci_ciModelName + "' ></a>";
 }
 if (obj.ci_ciCarModel != null && obj.ci_ciCarAir != null) {
 div += "<h3>" + obj.ci_ciModelLine + " " + obj.ci_ciCarModel + " " + obj.ci_ciCarAir + " " + obj.ci_ciTransmission + " " + obj.ci_ciModelName + "</h3>";
 }
 else {
 div += "<h3>" + obj.ci_ciModelLine + " " + obj.ci_ciTransmission + " " + obj.ci_ciModelName + "</h3>";
 }
 div += "<p>上牌" + obj.ci_ciRegistration.substring(0, 4) + " | " + obj.ci_ciMileage + "万公里 | " + obj.ci_ciArea + "</p>";
 div += "<p class='price'>RMB:" + obj.ci_ciPrice + "</p>";
 //div+="<p><a href='#' class='s-url'>"+obj.ci_ciAgcyName+" </a> <span class='icon-gold'></span></p>";
 if (obj.dd_shopHomeNick != null && obj.dd_shopHomeNick != '') {
 div += "<p><a href='" + path + "/dealer/home/" + obj.ci_ciLoginId + ".html' class='s-url' title='" + obj.dd_shopHomeNick + "'>" + obj.dd_shopHomeNick + " </a> <span class='icon-gold'></span></p>";
 }
 else {
 }
 /!*div+="<p>0首付 低月供 即刻拥有</p>";*!/
 div += "</div>";
 div += "</div>";
 $("#tuijian").append(div);
 }
 }, "json");
 }*/

function imgchang(src, size) {
    var index = src.lastIndexOf(".");
    if (index > 0) {
        var imgtype = src.substring(index);
        src = src.replace(imgtype, "_" + size + imgtype);
    }
    return src;
}
//城市切换
function changecity(city) {
    // 创建一个 form
    var form1 = document.createElement("form");
    form1.id = "form1";
    form1.name = "form1";
    // 添加到 body 中
    document.body.appendChild(form1);
    // 创建一个输入
    var input2 = document.createElement("input");
    // 设置相应参数
    input2.type = "text";
    input2.name = "city";
    input2.value = city;
    // 将该输入框插入到 form 中
    form1.appendChild(input2);
    // form 的提交方式
    form1.method = "POST";
    // form 提交路径
    form1.action = "index";
    //form1.action = "changecity";
    // 对该 form 执行提交
    form1.submit();
    // 删除该 form
    document.body.removeChild(form1);

}
//字母数组
//var zm=['A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z'];
function getcityList() {
    $(".list").empty();//清空原list
    for (var i = 0; i < zm.length; i++) {//循环zm 由于dcitys里的顺序本身就是按照abcd来排序的所以不需要逐个和zm里的ABCD进行比对，只需要按照zm的顺序循环比对即可
        var num = 0;//定义num来判断zm和dcity中的字母是否匹配
        for (var j = 0; j < dcitys.length; j++) {
            if (j >= 0) {
                var dcity = dcitys[j];//获取每一个dcity对象
                var number = dcity[0];//获取id
                var name = dcity[1];//获取字母与名称
                name = name.split(" "); //分割空格 获取字母与名称的数组
                if (zm[i] == name[0]) {//如果zm与dcity的字母相同则把对应的信息拼接出来，如果没有相同的则dd不显示对应zm里的字母。
                    if (num < 1) {
                        //如果在相同zm里，第一次进入则拼接dl
                        $(".list").append("<dl><dt>" + name[0] + "</dt><dd><span><a href='#' onclick=changecity('" + number + "')>" + name[1] + "</a></span></dd></dl>");
                    } else {
                        //如果在相同zm里已经有dl则直接在dd里面拼接span
                        $(".list dl:last dd:last").append("<span><a href='#' onclick=changecity('" + number + "')>" + name[1] + "</a></span>");
                    }
                    num = num + 1;
                }
            }
        }
    }
}
//查询标签车源
function findTagCar(start,end,address,cartag){
    $.post('findTagCar.json', {'start': start, 'end': end, 'changecity': address,'ci_tagIds':cartag}//将显示的条数当参数传入，以后查询carinfo的方法，尽量当用这个后台，后台可继续改造
        , function (data) {
            var result = eval(data);
            $("#zuixin").empty();//由于切换是ajax不刷新页面所以，在更新车辆时得清空下
            var div = "";
            // div += "<div class='item fast item_w' id='zuixinfirst'>";
            // div += "<a class='hb'>";
            // div += "<div class='mi'>";
            // div += "<p class='name'>最新车源</p>";
            // div += "<p>精选放心车源，闪耀开启便捷之旅</p>";
            // div += "</div>";
            // div += "<img src='" + path + "/images/temp1.jpg'/></a>";
            // div += "</div>";
            //追加固定的第一个。
            if (result == null || result == '') {
                div += "<div><h2>本地暂无车型</h2></div>";
                $("#zuixin").append(div);
            } else {
                $("#zuixin").append(div);
            }
            for (var i in result) {
                var obj = result[i];
               console.log(obj);
                var div = "";
                if (i == 0) {
                    div += "<div class='item fast-m item_w' id='item fast-m item_w'>";
                } else {
                    div += "<div class='item item_w' id='item item_w'>";
                }
                //<a href='#'><img src='"+path+"/'"+obj.cad_file_path+".'"+obj.cad_cadFileExtensionName+"' /></a>
                var lineName = obj.ci_ModelLineMapName;//优先映射后的简称
                var lineType = obj.ci_ModelLineMapType;//车系数据来源：1 字典表的旧数据，2 第一车网新数据
                if(lineName == null || lineName == ""){
                    lineName = obj.ci_ciModelLine;
                }
                var carName;
                if(lineType==2){//第一车网数据，车型名称信息全面，比较长，不用再拼接
                    carName = obj.ci_ciModelName;
                }else if (obj.ci_ciCarModel != null && obj.ci_ciCarAir != null) {
                    carName= lineName + " " + obj.ci_ciCarModel + " " + obj.ci_ciCarAir + " " + obj.ci_ciTransmission + " " + obj.ci_ciModelName;
                } else {
                    carName = lineName + " " + obj.ci_ciTransmission + " " + obj.ci_ciModelName;
                }
// console.log(carName);

                var tags = [];
                if(obj.ci_tagIds!=null) {
                    tags = obj.ci_tagIds.split("_");
                    // console.log("tags:"+tags);
                }
                var ci_tags = "";
                // var img_tags = "";
                for(var i in tags){
                    switch (tags[i])
                    {
                        /*case "1":
                         tags[i]="准新车";
                         $(".tagIds").html()
                         ci_tags +=  '<span>' + tags[i] + '</span>';
                         break;*/
                        case "2":
                            tags[i]="官方认证";
                            ci_tags +=  '<span>' + tags[i] + '</span>';
                            // img_tags = '<div class="img_ershou">'+'</div>';
                            break;
                        case "3":
                        	
                            tags[i]="1年0利率";
                            ci_tags +=  '<span>' + tags[i] + '</span>';
                            break;
                        /*case "4":
                         tags[i]="练手车";
                         ci_tags +=  '<span>' + tags[i] + '</span>';
                         break;
                         case "5":
                         tags[i]="超值精选";
                         ci_tags +=  '<span>' + tags[i] + '</span>';
                         break;
                         case "6":
                         tags[i]="免费过户";
                         ci_tags +=  '<span>' + tags[i] + '</span>';
                         break;
                         case "7":
                         tags[i]="降价急售";
                         ci_tags +=  '<span>' + tags[i] + '</span>';
                         break;
                         case "8":
                         tags[i]="原厂质保";
                         ci_tags +=  '<span>' + tags[i] + '</span>';
                         break;*/
                    }
                }

                var istrue = isTrue(tags)
                // tags.contains1("官方认证")

                if(istrue){
                    if (obj.ai_groupPrice === ""){
                        div += "<div class='image'>" +
                            "<a href='" + path + "/detail/" + obj.ci_ciReleaseNumber + ".html' target='_blank'>" +
                            "<img id='imgp' src='" + imgpath + "/" + obj.cad_file_path + "." + obj.cad_cadFileExtensionName + "'  class='zuixincarimg'/>" +
                            "</a>" +
                            "<div class='old_car'></div>"+
                            "</div>";
                        div += "<div class='info' id='zuixin'>";
                        div += "<a href='" + path + "/detail/" + obj.ci_ciReleaseNumber + ".html' class='b-url' title='" + carName + "'target='_blank'></a>";
                        div += "<h3>" + carName + "</h3>";
                        div += "<p>" + obj.ci_ciMileage + "万公里 | " + obj.ci_ciRegistration.substring(0, 4) + " | " + obj.ci_ciArea + "</p>";
                        div += "<p class='hiddle_original' style='opacity: 0'><s>新车指导价:<span class='hiddle_originalCount'>"+obj.ai_groupPrice+"</span>万</s></p>";
                        div += "<p class='price'>"+"<span class='price_first'>二手价:</span>" + "<span class='price-pullright'>"  + "￥" + obj.ci_ciPrice + "万" + "</span>"+"<span class='price_second'>（二手价）</span>"+"</p>";
                        div += "<p class='tagIds'>" + ci_tags + "</p>";
                    }else {
                        div += "<div class='image'>" +
                            "<a href='" + path + "/detail/" + obj.ci_ciReleaseNumber + ".html' target='_blank'>" +
                            "<img id='imgp' src='" + imgpath + "/" + obj.cad_file_path + "." + obj.cad_cadFileExtensionName + "'  class='zuixincarimg'/>" +
                            "</a>" +
                            "<div class='old_car'></div>" +
                            "</div>";
                        div += "<div class='info' id='zuixin'>";
                        div += "<a href='" + path + "/detail/" + obj.ci_ciReleaseNumber + ".html' class='b-url' title='" + carName + "'target='_blank'></a>";
                        div += "<h3>" + carName + "</h3>";
                        div += "<p>" + obj.ci_ciMileage + "万公里 | " + obj.ci_ciRegistration.substring(0, 4) + " | " + obj.ci_ciArea + "</p>";
                        div += "<p class='hiddle_original'><s>新车指导价:<span class='hiddle_originalCount'>" + obj.ai_groupPrice + "</span>万</s></p>";
                        div += "<p class='price'>"+"<span class='price_first'>二手价:</span>" + "<span class='price-pullright'>"  + "￥" + obj.ci_ciPrice + "万" + "</span>"+"<span class='price_second'>（二手价）</span>"+"</p>";
                        div += "<p class='tagIds'>" + ci_tags + "</p>";
                    }
                }else {
                    if (obj.ai_groupPrice === ""){
                        div += "<div class='image'>" +
                            "<a  href='" + path + "/detail/" + obj.ci_ciReleaseNumber + ".html' target='_blank'>" +
                            "<img id='imgp' src='" + imgpath + "/" + obj.cad_file_path + "." + obj.cad_cadFileExtensionName + "'  class='zuixincarimg'/>" +
                            "</a>" +
                            "</div>";
                        div += "<div class='info' id='zuixin'>";
                        div += "<a href='" + path + "/detail/" + obj.ci_ciReleaseNumber + ".html' class='b-url' title='" + carName + "'target='_blank'></a>";
                        div += "<h3>" + carName + "</h3>";
                        div += "<p>" + obj.ci_ciMileage + "万公里 | " + obj.ci_ciRegistration.substring(0, 4) + " | " + obj.ci_ciArea + "</p>";
                        div +=  "<p class='hiddle_original' style='opacity: 0'><s>新车指导价:<span class='hiddle_originalCount'>"+obj.ai_groupPrice+"</span>万</s></p>";
                        div += "<p class='price'>"+"<span class='price_first'>二手价:</span>" + "<span class='price-pullright'>"  + "￥" + obj.ci_ciPrice + "万" + "</span>"+"<span class='price_second'>（二手价）</span>"+"</p>";
                        div += "<p class='tagIds'>" + ci_tags + "</p>";
                    }else{
                        div += "<div class='image'>" +
                            "<a href='" + path + "/detail/" + obj.ci_ciReleaseNumber + ".html' target='_blank'>" +
                            "<img id='imgp' src='" + imgpath + "/" + obj.cad_file_path + "." + obj.cad_cadFileExtensionName + "'  class='zuixincarimg'/>" +
                            "</a>" +
                            "</div>";
                        div += "<div class='info' id='zuixin'>";
                        div += "<a href='" + path + "/detail/" + obj.ci_ciReleaseNumber + ".html' class='b-url' title='" + carName + "'target='_blank'></a>";
                        div += "<h3>" + carName + "</h3>";
                        div += "<p>" + obj.ci_ciMileage + "万公里 | " + obj.ci_ciRegistration.substring(0, 4) + " | " + obj.ci_ciArea + "</p>";
                        div +=  "<p class='hiddle_original'><s>新车指导价:<span class='hiddle_originalCount'>"+obj.ai_groupPrice+"</span>万</s></p>";
                        div += "<p class='price'>"+"<span class='price_first'>二手价:</span>" + "<span class='price-pullright'>"  + "￥" + obj.ci_ciPrice + "万" + "</span>"+"<span class='price_second'>（二手价）</span>"+"</p>";
                        div += "<p class='tagIds'>" + ci_tags + "</p>";
                    }
                }

                // div += "<div class='image'>" +
                //     "<a href='" + path + "/detail/" + obj.ci_ciReleaseNumber + ".html' target='_blank'>" +
                //     "<img src='" + imgpath + "/" + obj.cad_file_path + "." + obj.cad_cadFileExtensionName + "'  class='zuixincarimg'/>" +
                //     "</a>" +
                //     "<div class='old_car'></div>"+
                //     "</div>";
                // div += "<div class='info' id='zuixin'>";
                // div += "<a href='" + path + "/detail/" + obj.ci_ciReleaseNumber + ".html' class='b-url' title='" + carName + "'target='_blank'></a>";
                // div += "<h3>" + carName + "</h3>";
                // div += "<p class='tagIds'>" + ci_tags + "</p>";
                // div += "<p>上牌" + obj.ci_ciRegistration.substring(0, 4) + " | " + obj.ci_ciMileage + "万公里 | " + obj.ci_ciArea + "</p>";
                // div += "<p class='price'>二手价" + "<span class='price-pullright'>"  + "<span>" +"￥" + "</span>" + obj.ci_ciPrice + "</span>" +"</p>";
                //
                // //车源标签
                // div += "<p class='price'>" + obj.ci_tagIds + "</p>";
//                    console.log(obj.ci_tagIds);

                // console.log(tags);

                // 经销商地址删掉

                // if (obj.dd_shopHomeNick != null && obj.dd_shopHomeNick != '') {
                //     div += "<p><a href='" + path + "/dealer/home/" + obj.ci_ciLoginId + ".html' class='s-url' title='" + obj.dd_shopHomeNick + "' target='_blank'>" + obj.dd_shopHomeNick + " </a> <span class='icon-gold'></span></p>";
                // }
                /*div+="<p>0首付 低月供 即刻拥有</p>";*/
                div += "</div>";
                div += "</div>";
                $("#zuixin").append(div);
            }
        }, "json");

}
function isTrue(obj) {
    for (var i = 0;i< obj.length;i++){
        if (obj[i] == "官方认证"){
            return true;
        }
    }

}
// Array.prototype.contains1 = function (obj) {
//     var i = this.length;
//     while (i--) {
//         if (this[i] === obj) {
//             return true;
//         }
//     }
//     return false;
// }
//初始化城市
function initCity(obj) {
    for (var i = 0; i < zm.length; i++) {//循环zm 由于dcitys里的顺序本身就是按照abcd来排序的所以不需要逐个和zm里的ABCD进行比对，只需要按照zm的顺序循环比对即可
        var num = 0;//定义num来判断zm和dcity中的字母是否匹配
        for (var j = 0; j < obj.length; j++) {
            if (j >= 0) {
                var dcity = obj[j];//获取每一个dcity对象
                var number = dcity.CID;//获取id
                var name = dcity.REMARK;//获取字母与名称
                name = name.split(" "); //分割空格 获取字母与名称的数组
                if (zm[i] == name[0]) {//如果zm与dcity的字母相同则把对应的信息拼接出来，如果没有相同的则dd不显示对应zm里的字母。
                    if (num < 1) {
                        //如果在相同zm里，第一次进入则拼接dl
                        $(".toggle-city-fy .ty-list").append("<dl><dt>" + name[0] + "</dt><dd><span><a href='#' onclick=changecity('" + number + "')>" + name[1] + "</a></span></dd></dl>");
                    } else {
                        //如果在相同zm里已经有dl则直接在dd里面拼接span
                        $(".toggle-city-fy .ty-list dl:last dd:last").append("<span><a href='#' onclick=changecity('" + number + "')>" + name[1] + "</a></span>");
                    }
                    num = num + 1;
                }
            }
        }
    }
}

//格式化金钱
function formatMoney(inputMoney,defaultWhereIsNaN) {
    // console.log(inputMoney);
    var money = (inputMoney+"").replace(",","");
    if(!isNaN(money) && money.length > 0) {
        var arrPrice = money.split(".");
        var intArrayPrice = arrPrice[0].split("");
        for(var i = intArrayPrice.length-3; i> 0; i = i-3) {
            intArrayPrice.splice(i, 0, ",");
        }
        var intPrice = intArrayPrice.join("");
        if(arrPrice.length > 1 ){
            return intPrice + "." + arrPrice[0];
        } else {
            return intPrice;
        }
    } else {
        return defaultWhereIsNaN ? defaultWhereIsNaN : inputMoney;
    }
}
function initDom(){
    // 获取开通经销商城市信息
    getDealercityList();
    findTagCar(1,8,"",null);
    //调用获取推荐城市的方法
    //  findAdviceCar(2, 7, "");
}
// setTimeout(
//     $(".hiddle_original").each(function () {
//         if ($(this).find("span").text() == ""){
//             $(this).css("opacity","0");
//         }
//     }),0)

