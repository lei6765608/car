var po,previd,isCityList=false;
var dftCity = "dftCity";
$(function(){
	$("#city-down a.cur").attr("id",dftCity);

	
	$(".sort-wrap").click(function(){
		return false;	
	});
	$(".sort-list li").click(function(){
		var type = $(this).attr("type");
		if($(this).hasClass("cur")){
			$(".sort-list li").removeClass("cur");
			previd = '';
			$("."+type).fadeOut();
			//$(document).unbind("click");
		}else{
			$(".sort-list li").removeClass("cur");
			$(this).addClass("cur");
			
			
			if(previd==type){
				return false;	
			}
			if(previd!=''){
				$("."+previd).fadeOut();
			}
			$("."+type).fadeIn();
			if(!isCityList && type=='select-city'){
				isCityList = true;
				var myCityList = new IScroll('#city-down', {
					scrollbars: true,
					mouseWheel: true,
					interactiveScrollbars: true,
					shrinkScrollbars: 'scale',
					fadeScrollbars: true,
					click: true
				});
			}
			po = $(this);
			previd = type;
			
			$(document).unbind("click");
			$(document).bind("click",function(){
				$("."+previd).fadeOut();
				previd = '';
				$(this).unbind("click");
				$(".sort-list li").removeClass("cur");
			});
		}
		$(".select-more .select").removeClass("cur");
		return false;
	});
	
	if("ontouchend" in document){
		if($(".sort-list").size()>0){
			$(".sort-list").addClass("sort-touch");
		}
	}
	
	$(window).bind("scroll",function(){
		if($(".select-city").is(":visible")){
			$(document).click();
		}	
		if($(".select-type").is(":visible")){
			$(document).click();
		}	

		var top = $(".sort").offset().top;
		
		if($(window).scrollTop() >= top){
			if(!$(".sort-position").hasClass("sort-position-cur")){
				$(".sort-position").addClass("sort-position-cur");
			}
		}else{
			if($(".sort-position").hasClass("sort-position-cur")){
				$(".sort-position").removeClass("sort-position-cur");
			}
		}
		
	}).bind("resize",function(){
		resetSortHeight();
	});
	resetSortHeight();

});

$(function () {
    //车系名
    var car_typeA = [];
    var car_typeQ = [];
    var car_typeR = [];
    var car_typeS = [];
    var car_typeOthers = [];
    //车系id
    var carId_A = [];
    var carId_Q = [];
    var carId_R = [];
    var carId_S = [];
    var carId_Others = [];


    $(".sort-wrap #down-type").click(function(){
        car_typeA = [];
        car_typeQ = [];
        car_typeR = [];
        car_typeS = [];
        car_typeOthers = [];

        carId_A = [];
        carId_Q = [];
        carId_R = [];
        carId_S = [];
        carId_Others = [];

        $.ajax({
            type: "GET",
            url: path+"/activityModelLines",
            async: false,
            dataType: "json",
            success: function (data) {
                $.each(data,function (index, item) {
                    if(item == null || item == ''){
                        return;
                    }
                    if(item.lineName.indexOf("A") == 0){
                        car_typeA.push(item.lineName);
                        carId_A.push(item.lineIds);
                    }else if (item.lineName.indexOf("Q") == 0){
                        car_typeQ.push(item.lineName);
                        carId_Q.push(item.lineIds);
                    }else if (item.lineName.indexOf("R") == 0){
                        car_typeR.push(item.lineName);
                        carId_R.push(item.lineIds);
                    }else if (item.lineName.indexOf("S") == 0){
                        car_typeS.push(item.lineName);
                        carId_S.push(item.lineIds);
                    }else {
                        car_typeOthers.push(item.lineName);
                        carId_Others.push(item.lineIds);
                    }
                });
            }
        });
    });

    $(".type-list1 li").each(function () {
        var url = $(".hiddle_carType li:eq(0) a").attr("href");
        var index;
        $(this).mouseover(function () {
            index = null;
            $('.hiddle_carType').empty();
            index = $(this).index();
            $(this).addClass("cur").siblings().removeClass("cur");
            $(this).find("img").addClass("cur");
            $(this).siblings().find("img").removeClass("cur");

            $(".hiddle_carType").addClass("cur");
            if (index == 1){
                for (var i = 0;i < car_typeA.length;i++){
                    var div = '<li><a href="'+url+'&ci_ciModelLine='+carId_A[i]+'&ci_ciModelName='+car_typeA[i]+ '" onClick="changeType(this)">'+car_typeA[i]+'</a></li>';
                    $(".hiddle_carType").append(div);
                }
            }else if(index == 2){
                for (var i = 0;i < car_typeQ.length;i++){
                    var div = '<li><a href="'+url+'&ci_ciModelLine='+carId_Q[i]+'&ci_ciModelName='+car_typeQ[i]+'" onClick="changeType(this)">'+car_typeQ[i]+'</a></li>';
                    $(".hiddle_carType").append(div);
                }
            }else if(index == 3){
                for (var i = 0;i < car_typeR.length;i++){
                    var div = '<li><a href="'+url+'&ci_ciModelLine='+carId_R[i]+'&ci_ciModelName='+car_typeR[i]+'" onClick="changeType(this)">'+car_typeR[i]+'</a></li>';
                    $(".hiddle_carType").append(div);
                }
            }else if(index == 4){
                for (var i = 0;i < car_typeS.length;i++){
                    var div = '<li><a href="'+url+'&ci_ciModelLine='+carId_S[i]+'&ci_ciModelName='+car_typeS[i]+'" onClick="changeType(this)">'+car_typeS[i]+'</a></li>';
                    $(".hiddle_carType").append(div);
                }
            }else if(index == 5){
                for (var i = 0;i < car_typeOthers.length;i++){
                    var div = '<li><a href="'+url+'&ci_ciModelLine='+carId_Others[i]+'&carType='+car_typeOthers[i]+'" onClick="changeType(this)">'+car_typeOthers[i]+'</a></li>';
                    $(".hiddle_carType").append(div);
                }

            }else if(index == 0){
                for (var i = 0;i < 1;i++){
                    var div = '<li><a href="'+url+'" onClick="changeType(this)">不限车系</a></li>';
                    $(".hiddle_carType").append(div);
                }
            }
            $('.hiddle_carType a').click(function() {
                var url = $(this).attr("href");
                window.location.href = url;
                $('.hiddle_carType').empty().removeClass("cur");
            });

        });
        $("#hiddle_carType_wrap").mouseleave(function () {
            $(".type-list1 img").removeClass("cur");
            $(".type-list1 li").removeClass("cur");
            $('.hiddle_carType').empty().removeClass("cur");
        });
    });

});

function changeType(obj){
    var txt = $(obj).html();
    $("#down-type .df").html(txt);
    $("."+previd).fadeOut();
    previd = '';
    if(txt!=$(".type-list li").eq(0).text()){
        $("#down-type .df").css({color:'#c03'});
    }else{
        $("#down-type .df").removeAttr("style");
    }

    $(".sort-list li").removeClass("cur");
}

//筛选 城市
function changeCity(obj){
	var txt = $(obj).html();
	$("#down-city .df").css({color:'#c03'});
	$("#down-city .df").html(txt);	
	$("."+previd).fadeOut();
	previd = '';
	
	$(".sort-list li").removeClass("cur");
	$(".city-list a").removeClass("cur");
	obj.className = "cur";
	
	$(".select-city").fadeOut();
}
//筛选 车型
function changeType(obj){
	var txt = $(obj).html();
	$("#down-type .df").html(txt);	
	$("."+previd).fadeOut();
	previd = '';
	if(txt!=$(".type-list li").eq(0).text()){
		$("#down-type .df").css({color:'#c03'});
	}else{
		$("#down-type .df").removeAttr("style");
	}
	
	$(".sort-list li").removeClass("cur");
}

function resetSortHeight(){
	$(".sort").height($(".sort-position").height());
}
// select下拉
$(function(){
    $(".w_ment p").click(function() {
    	$(this).parent().siblings().removeClass('selected');
        $(this).parent().toggleClass('selected');
    });
    $(".w_ment .type-down").click(function() {
        $(this).parent().removeClass('selected');
    });
    $(document).bind("click",function(e){ 
		var target = $(e.target); 
		if(target.closest(".select").length == 0){ 
		   $(".select").removeClass('selected');
		} 
	});
	$(".oz a").click(function(){
		var o = $(this).text();
		$(this).parents(".select").find(".type-down.type-down-oz ul").scrollTop(0);
		var t = ($(this).parents(".select").find("#"+o).offset().top -$(this).parent().offset().top);
		$(this).parents(".select").find(".type-down.type-down-oz ul").scrollTop(t);

		return false;
	});
}); 
function ozselect(obj){
	
	var o = $(obj).text();
	$(obj).parents(".select").find(".type-down.type-down-oz ul").scrollTop(0);
	var t = ($(obj).parents(".select").find("#"+o).offset().top -$(obj).parent().offset().top);
	$(obj).parents(".select").find(".type-down.type-down-oz ul").scrollTop(t);

	return false;
}


// 价格切换
$(function(){
    $("a.tabs_z").click(function() {
    	$(this).siblings().removeClass('active');
        $(this).addClass('active');
    });  
    $(".w_ment .btn").click(function() {
        //$(".w_ment").css("display","none");
        //$(".n_ment").css("display","block");
    });
	$('a.tabs_z1').click(function(){
		$(".span_1").addClass('active');
        $(".span_2,.span_3").removeClass('active');
	    var html = $('.span_1 .obtain').html();
	    $('.r span').html("").append(html);
	    var str = $(".r span").text().substr(0,4);
	    $('.r span').text(str);
	}); 
	$('a.tabs_z2').click(function(){
		$(".span_2").addClass('active');
        $(".span_1,.span_3").removeClass('active');
	    var html = $('.span_2 .obtain').html();
	    $('.r span').html("").append(html);
	    var str = $(".r span").text().substr(0,4);
	    $('.r span').text(str);
	});
	$('a.tabs_z3').click(function(){
		$(".span_3").addClass('active');
        $(".span_1,.span_2").removeClass('active');
	    var html = $('.span_3 .obtain').html();
	    $('.r span').html("").append(html);
	    var str = $(".r span").text().substr(0,4);
	    $('.r span').text(str);
	});
}); 




