/*
 Global
 */
$(function(){
    $("#header .mbtn-search,#homepageheader .mbtn-search").click(function(){
        var obj = $(" #homepageheader .btn-search");
        if(!obj.hasClass("cur")){
            obj.addClass("cur")
            $("#search-pop").css({marginTop:-10,opacity:0,display:'block'}).animate({marginTop:0,opacity:1});
        }
    });
    $("#header .btn-search , #homepageheader .btn-search").click(function(){
        var _this = this;
        if(_this.lock && _this.lock != undefined){
            return false;
        }
        if(!$(this).hasClass("cur")){

            $(this).addClass("cur");
            this.lock = true;
            $("#search-pop").css({marginTop:-10,opacity:0,display:'block'}).animate({marginTop:0,opacity:1},function(){
                _this.lock=false;
            });

            $("#search-pop").bind("mouseup",function(){
                return false;
            });

            if("ontouchend" in document){
                var bg = $("#search-pop .bg");
                bg.css({opacity:0, position: 'fixed'});
                bg.unbind("touchstart");
                bg.bind("touchstart",function(e){
                    $("#search-pop .close").trigger("click");
                    $(this).unbind("touchstart");
                });
            }else{
                $(document).bind("mouseup",function(e){
                    $(this).unbind("mouseup");
                    $("#search-pop .close").click();
                });
                return false;
            }
        }else{
            $("#search-pop .close").click();
        }
    }).bind("mouseup",function(e){
        return false;
    });
    var searchIsScroll = false;
    $("#header .icon-location , #homepageheader .icon-location").click(function(){
        $("#toggle-city").fadeIn();
        $('body').css('position','fixed');
        if(!searchIsScroll){
            searchIsScroll = true;
            loaded();
        }
    });
    $("#toggle-city .close").click(function(){
        $("#toggle-city").fadeOut();
        $('body').css('position','relative');
    });
    $("#search-pop .close").click(function(){
        $("#header .btn-search").removeClass("cur");
        $("#homepageheader .btn-search").removeClass("cur");
        $("#search-pop").animate({marginTop:-10,opacity:0},function(){
            $(this).hide();
        });
        $("#search-pop .bg").removeAttr("style");
        $(document).unbind("mouseup");
    });
    $("#search-pop .btn-delete").click(function(){
        $("#search-pop .input input").val('');
    });
    $(".auxiliary dl dt").click(function(){
        var obj = $(this).parent();
        if(obj.hasClass("cur")){
            obj.removeClass("cur");
        }else{
            obj.addClass("cur");
        }
    });
    $("#search-pop .select p").click(function(){
        var _this = $(this);
        if(_this.parent().find("ul").is(":visible")){
            $(document).click();
        }else{
            _this.parent().find("ul").fadeIn();
            $(document).unbind("click");
            $(document).bind("click",function(e){
                $(".select .type-down").fadeOut();
                $(this).unbind("click");
            });
        }
        return false;
    });
    $(".select .type-down li a").click(function(){
        var _this = $(this);
        var txt = _this.html();
        if(_this.parent().parent().parent().hasClass("type-down-oz")){
            _this.parent().parent().parent().parent().find("p").html(txt);
            _this.parent().parent().parent().parent().removeClass('selected active');
        }else{
            _this.parent().parent().parent().find("p").html(txt);
            _this.parent().parent().parent().removeClass('active');
        }
    });
    $("#search-pop .input input").focus(function(){
        $("#search-pop .input ul").fadeIn();
    });

    $("#search-pop .input input").blur(function(){
        $("#search-pop .input ul").fadeOut();
    });

    $("#go-top").bind("mousedown",function(){
        $("html,body").animate({scrollTop:0});
    });


    $(".mobile-menu , .mobile-menus").click(function(){
        if($(".mobile-menu-box").hasClass("cur")){
            $(".mobile-menu-box").removeClass("cur");
        }else{
            $(".mobile-menu-box").addClass("cur");
        }

        $(document).unbind("click");
        $(document).bind("click",function(e){
            $(".mobile-menu-box").removeClass("cur");
            $(this).unbind("click");
        });
        return false;
    });

    var myScroll;
    function loaded () {
        myScroll = new IScroll('#city-list', {
            scrollbars: true,
            mouseWheel: true,
            interactiveScrollbars: true,
            shrinkScrollbars: 'scale',
            fadeScrollbars: true,
            click: true
        });
    }

    if("ontouchend" in document){
        var mnavtop = 0;
        $(window).bind("scroll",function(){
            $(".mobile-menu-box").removeClass("cur");

            if($(".mobile-navbar a.nav").size()>3){
                var top = $(window).scrollTop();
                if(mnavtop > top){
                    $(".mobile-navbar").show();
                }else{
                    $(".mobile-navbar").show();
                }
                mnavtop =top;
            }
        });
        $("a").bind("touchstart",function(e){
            if(!$(this).hasClass("active")){
                $(this).addClass("active");
            }
            if($(this).hasClass("visited")){
                $(this).removeClass("visited");
            }
        });
        $("a").bind("touchend",function(e){
            if($(this).hasClass("active")){
                $(this).removeClass("active");
            }
            if(!$(this).hasClass("visited")){
                $(this).addClass("visited");
            }
        });
    }


    $(window).bind("resize",function(){
        resetActInfo();
    });
    $(window).bind("load",function(){
        resetActInfo();
    });
    setTimeout(function(){
        resetActInfo();
    },100);
    setTimeout(function(){
        resetActInfo();
    },500);
    resetActInfo();
    GetRTime();

    GetBiddingRTime();

});



//打开对比浮层
function openContrast(){
    _smq.push(['custom','pc/产品信息__侧边栏','对比',new Date()]);
    $("#contrast-pop").fadeIn();
}

//关闭对比浮层
function closeContrast(){
    $("#contrast-pop").fadeOut();
}

//清空对比
function clearContrast(){

}



//倒计时
function GetRTime(){
    for(i=0;i<$(".dtime").size();i++){
        new djs($(".dtime").eq(i),$(".dtime").eq(i).attr("d"),function(obj,txt){
            if(txt=="false"){
                if(obj.parent().parent().parent().find(".btn").html()!=undefined){
                    obj.parent().parent().parent().find(".btn").html('<a href="replacement-daijinquan.html" style="display:none;"  >已结束</a><a href="javascript:;" class="gray">已结束</a></div>');
                }
                if(obj.parent().html()!=undefined){
                    obj.parent().html("<span class='dtime' d='' >已结束</span>");
                }
            }else{
                obj.html(txt);
            }
        });
    }
    var beginAndEndTime=$('.time').text();
    var endTime= beginAndEndTime.substring(beginAndEndTime.indexOf('-')+1);
    var now=new Date();
    var  Y = now.getFullYear();
    var  M =now.getMonth()+ 1 < 10 ? ('0'+(now.getMonth()+1)) : (now.getMonth()+1);
    var  D = now.getDate() < 10 ? ('0'+ now.getDate()) : now.getDate();
    var time=Y+'.'+M+'.'+D;
    console.log(time);
    if(endTime<time){
        var btnA =  $('.time').parent().parent().parent().find(".btn a");
        // console.info(aaa.html());
        btnA.html("已结束");
        btnA.css("background-color", "#e7e8ea");
        btnA.css("color", "#000");
        btnA.attr("href","javascript:;");
    }

}

//biddingdtime
function GetBiddingRTime(){

    for(i=0;i<$(".biddingdtime").size();i++){
        new djs($(".biddingdtime").eq(i),$(".biddingdtime").eq(i).attr("d"),function(obj,txt){
            //定时器结束自动变色
            if(txt=="false"){
                obj.parent().parent().css('background','#999');
                obj.parent().parent().prev().css('border-bottom-color','#999');
                if(obj.parent().html()!=undefined){
                    obj.parent().html("<span class='biddingdtime' d='' >已结束</span>");
                }
            }else{
                obj.html(txt);
            }
        });
    }
    /*var beginAndEndTime=$('.time').text();
    var endTime= beginAndEndTime.substring(beginAndEndTime.indexOf('-')+1);
    // console.log(endTime);
    var now=new Date();
    var  Y = now.getFullYear();
    var  M =now.getMonth()+ 1 < 10 ? ('0'+(now.getMonth()+1)) : (now.getMonth()+1);
    var  D = now.getDate() < 10 ? ('0'+ now.getDate()) : now.getDate();

    var time=Y+'.'+M+'.'+D;
    //console.log(time);
    if(endTime<time){
        var btnA =  $('.time').parent().parent().parent().find(".btn a");
        // console.info(aaa.html());
        btnA.html("已结束");
        btnA.css("background-color", "#e7e8ea");
        btnA.css("color", "#000");
        btnA.attr("href","javascript:;");
    }*/

}
function getSevertime(){
    var xmlHttp = new XMLHttpRequest();
    if( !xmlHttp ){
        xmlHttp = new ActiveXObject("Microsoft.XMLHTTP");
    }
    xmlHttp.open("HEAD",location.href,false);
    xmlHttp.send();
    var severtime=new Date(xmlHttp.getResponseHeader("Date"));
    return severtime;
}
// function djs(obj,date,callBack){
//     var _this = this;
//     _this.obj = obj;
//     _this.EndTime = new Date(date);
//     var time1;
//     var count = 0;
//     $.ajax({
//         type: "get",  //提交方式
//         url: path + "/common/getServiceTime",//路径
//         data:{},
//         success:function(data){
//             _this.NowTime = parseInt(data);
//             time1 = Math.floor((_this.EndTime.getTime() - _this.NowTime)/1000);
//             _this.getT = function(){
//                 count++;//每秒钟+1
//                 _this.t = time1 - count;
//                 _this.d=Math.floor(_this.t/60/60/24);
//                 _this.h=Math.floor(_this.t/60/60%24);
//                 _this.m=Math.floor(_this.t/60%60);
//                 _this.s=Math.floor(_this.t%60);
//                 if(callBack){
//                     var txt = _this.d + "天" + _this.h + "时" + _this.m + "分" + _this.s + "秒";
//                     callBack(_this.obj,txt);
//                 }
//             }
//             _this.getT();
//             _this.setInter = setInterval(_this.getT,1000);
//
//         }
//     });
function djs(obj,date,callBack){
    var _this = this;
    _this.obj = obj;
    // _this.NowTime = new Date($("#nowTime").val());//系统当前时间
    // console.log($("#nowTime").val());
    // console.log(_this.NowTime);
    var time1;
    var count = 0;
    _this.EndTime = new Date(date);
    $.ajax({
        type: "get",  //提交方式
        url: path + "/common/getServiceTime",//路径
        data:{},
        success:function(data){
            _this.NowTime = parseInt(data);
            time1 = Math.floor((_this.EndTime.getTime() - _this.NowTime)/1000);
            _this.getT = function(){
                count++;//每秒钟+1
                _this.t = time1 - count;
                _this.d=Math.floor(_this.t/60/60/24);
                _this.h=Math.floor(_this.t/60/60%24);
                _this.m=Math.floor(_this.t/60%60);
                _this.s=Math.floor(_this.t%60);
                if(callBack){
                    var txt = _this.d + "天" + _this.h + "时" + _this.m + "分" + _this.s + "秒";
                    if(_this.t<=0){
                        txt="false";
                    }
                    callBack(_this.obj,txt);
                }
            }
            _this.getT();
            _this.setInter = setInterval(_this.getT,1000);

        }
    });
    // var time1 = Math.floor((_this.EndTime.getTime() - _this.NowTime.getTime())/1000);
    // var count = 0;
    // _this.getT = function(){
    //     count++;//每秒钟+1
    //     _this.t = time1 - count;
    //     _this.d=Math.floor(_this.t/60/60/24);
    //     _this.h=Math.floor(_this.t/60/60%24);
    //     _this.m=Math.floor(_this.t/60%60);
    //     _this.s=Math.floor(_this.t%60);
    //
    //     if(callBack){
    //         var txt = _this.d + "天" + _this.h + "时" + _this.m + "分" + _this.s + "秒";
    //         if(_this.t<=0){
    //             txt="false";
    //         }
    //         callBack(_this.obj,txt);
    //     }
    // }
    // _this.getT();
    // _this.setInter = setInterval(_this.getT,1000);
}

//var t;
function resetActInfo(){
    if(($(window).width() > 1180 || ($(window).width() < 850)) && $(".act-box").size()>0){
        var h = $(".act-box .item .image img").height()-50;
        if(h<0){
            h = 217;
        }
        if($(window).width() <500){
            h = $(".act-box .item .image img").height()-33;
        }
        $(".act-box .item .mh").css("min-height",h);
    }

}