/**
 * Created by lql on 2017/7/30.
 */

/*根据参数名称生成匹配url参数部分的正则表达式调用返回对象的exec方法可以获取匹配结果对象
其中单个匹配结果说明：
0:匹配到的字符串, 1:开头连接符(?或者&), 2:参数名称, 3:参数值, index:匹配到的开始下标, length：4 ]*/
function getParamREG(name,modifiers) {
    /* 正则说明：以?或者&开头 + name + 等号= + 任意非&字符 + 以&结束或者直接匹配到尾部，并记录头部连接符、参数名称、参数值用于后续处理
     例如:
     url：http://auditest.beautyyan.cn/audi4s_front/auctionCarList?ci_ciArea=501&ci_ciModelLine=A3&cai_caiAutionStatus=100005
     分3种情况匹配到内容为 => 开头的：?ci_ciArea=501&    中间的：&ci_ciModelLine=A3&    尾部的：&cai_caiAutionStatus=100005
     */
    var mode = '(\\?|&)(' + name + ')=([^&]*)(?=&|$)';
    // console.log(mode);
    return new RegExp(mode, modifiers);
}
//格式化url：处理多余的?和&
function formatUrl(url) {
    if(isEmpty(url)) {
        return url;
    }
    return url.replace(/\?[\?&]*/g, '?').replace(/&+/g, '&').replace(/[\?&]+$/g, '');
}

//获取<当前>url的路径（不含参数部分）
function getCurrentUrlPath(url) {
    return getUrlPath(window.location.href);
}
//获取url的路径（不含参数部分）
function getUrlPath(url) {
    if (isEmpty(url)) {
        console.error("url为空");
        return url;
    }
    var index = url.indexOf("?");
    if (index > 0) {
        return url.substring(0,index);
    } else {
        return url;
    }
}

//获取url所有参数放入到对象中，key为参数名称
function getUrlParamList(url) {
    if (isEmpty(url)) {
        console.error("url为空");
        return {};
    }
    var paramsReg = getParamREG('[^=]*', 'g');
    var paramList = url.match(paramsReg);
    if (paramList && paramList.length > 0) {
        var result = {};
        for (var i = 0; i < paramList.length; i++) {
            var param = paramList[i].replace(/\?+/g ,'').replace(/&+/g, '').split('=');
            if (param.length > 1){
                result[param[0]] = param[1];
            }
        }
        return result;
    } else {
        return {};
    }
}

//根据名称删除<当前>url的参数
function removeCurrentUrlParam(url, name, blnReload) {
    return removeUrlParam(window.location.href, name, blnReload);
}
//根据名称删除url的参数
function removeUrlParam(url, name, blnReload) {
    if(isEmpty(url)) {
        console.error("url为空");
        return url;
    }
    url = formatUrl(url);
    var paramReg = getParamREG(name);
    var matchResult = paramReg.exec(url);
    // console.log(matchResult);
    //存在旧的则删除，不存在则返回原URL
    if (matchResult !== null) {
        // console.log(matchResult[3]);
        url = url.replace(paramReg, matchResult[3] === '' ? '' : matchResult[1]);
    }
    url = formatUrl(url);

    if (blnReload) {
        window.location.href = url;
    }
    return url;
}

//根据名称获取<当前>url中的参数值
function getCurrentUrlParam(name) {
    return getUrlParam(window.location.href, name);
}
//根据名称获取url中的参数值
function getUrlParam(url, name) {
    if(isEmpty(url)) {
        console.error("url为空");
        return "";
    }
    //连续的?跟&替换为单个，以及删除尾部的连接符
    url = formatUrl(url);
    var paramReg = getParamREG(name);
    var matchResult = paramReg.exec(url);
    if (matchResult !== null) {
        return matchResult[3];
    } else {
        return "";
    }
}

//根据名称设置<当前>URL相应参数的值
function setCurrentUrlParam(name, value, blnReload) {
    return setUrlParam(window.location.href, name, value, blnReload);
}
//根据名称设置URL相应参数的值
function setUrlParam(url, name, value, blnReload) {
    if(isEmpty(url)){
        console.error("url为空");
        return url;
    }
    if(isEmpty(name)){
        console.error("参数名name为空");
        return url;
    }
    //删除旧参数值
    url = removeUrlParam(url, name);
    //追加新参数值
    if (isNotEmpty(value)) {
        url += (url.indexOf('?') < 0 ? '?' : '&') + name + '=' + value;
    }
    //如果设置了刷新
    if (blnReload) {
        window.location.href = url;
    }
    return url;
}

//判断是否为空串：undefined、null、''
function isEmpty(value) {
    if (value === undefined || value === null || value === ''){
        return true;
    } else {
        return false;
    }
}

//判断不为空
function isNotEmpty(value) {
    return !isEmpty(value);
}