var browser = {
    versions : function() {
        var u = navigator.userAgent, app = navigator.appVersion;
        return {
            trident : u.indexOf('Trident') > -1, // IE
            presto : u.indexOf('Presto') > -1, // opera
            webKit : u.indexOf('AppleWebKit') > -1, // Apple or Chrome
            gecko : u.indexOf('Gecko') > -1 && u.indexOf('KHTML') == -1, // Firfox
            mobile : !!u.match(/AppleWebKit.*Mobile/)
            || !!u.match(/Windows Phone/) || !!u.match(/Android/)
            || !!u.match(/MQQBrowser/), // mobile
            ios : !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), // ios
            android : u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, // android
            iPhone : u.indexOf('iPhone') > -1, // iPhone or QQHD
            iPad : u.indexOf('iPad') > -1, // iPad
            webApp : u.indexOf('Safari') == -1
        };
    }()
};
function setCookie1(objName,objValue,time) {
    var str = objName + "=" + escape(objValue);
    if (time > 0) {//为0时不设定过期时间，浏览器关闭时cookie自动消失
        var date = new Date();
        var ms = time * 3600 * 1000;
        date.setTime(date.getTime() + ms);
        str += "; expires=" + date.toGMTString();
    }
    document.cookie = str;
}
function setCookie(objName, objValue, time){//添加cookie
    var str = objName + "=" + escape(objValue);
    if (time > 0) {//为0时不设定过期时间，浏览器关闭时cookie自动消失
        var date = new Date();
        var ms = time * 3600 * 1000;
        date.setTime(date.getTime() + ms);
        str += "; expires=" + date.toGMTString();
    }
    document.cookie = str;
}
$(function(){
    //getcityList1();
    //getcityList2();
    getDealercityList1();
    //getDealercityList2();
    var db = 0;
    var ids = getCookie("ids");
    if(ids!=null && ids!=""){
        //indexOf() 方法可返回某个指定的字符串值在字符串中首次出现的位置。
        var idx = ids.indexOf(",");
        if(idx!=-1){
            var arr = ids.split(",");
            for(var i=0;i<arr.length;i++){
                $("#"+arr[i]).addClass("cur");
            }
            db = arr.length;
            $(".fix-right .first-icon .redDot").show().html(db);

        }else{
            $("#"+ids).addClass("cur");
            db=1;
            $(".fix-right .first-icon .redDot").show().html(db);
        }

    }
    setarea("area","currcity","city");
    var ty= $('#s-type p').html() == "不限车型" ? "" : $('#s-type p').html();
    var ag= $('#s-age p').html() == "不限车龄" ? "" : $('#s-age p').html();
    var mi= $('#s-mileage p').html() == "不限里程数" ? "" : $('#s-mileage p').html();
    var tr= $('#s-gearbox p').html() == "不限变速箱" ? "" : $('#s-gearbox p').html();
    var em= $('#s-dissd p').html() == "不限排放标准" ? "" : $('#s-dissd p').html();
    var ai= $('#s-dis p').html() == "不限排量" ? "" : $('#s-dis p').html();
    var co= $('#s-color p').html() == "不限颜色" ? "" : $('#s-color p').html();
    var arr = [ty,ag,mi,tr,em,ai,co];
    //$("#selected-list").empty();
    for(var i =0;i<arr.length;i++){
        if(arr[i]!=null && arr[i]!=""){
            var t = $(".select-more .select:eq("+i+")").attr("id");
            var url =$('#'+t+' a:first').attr("href");
            var div = '<p id="p'+t+'" class="item"><span>'+arr[i]+'</span><a href="'+url+'" class="btn-delete"></a></p>';
            $('#selected-list').append(div);
            $(".sort").addClass("cur");
        }
    }
    if($("#selected-list").html()==""){
        if($(".sort").hasClass("cur")){
            $(".sort").removeClass("cur");
        }
    }
    resetSortHeight();
    //收藏
    $(".list-four").delegate(".icon-collection","click",function(){
        if($("#homepageheader input[name='user']").val()!=null){
            if($(this).hasClass("cur")){
                //移除收藏
                var code = $(this).parent().find("a:eq(0)").attr("id");
                collectionOp("c_deleteCollection",{ci_cCode:code,redirectURL:getRedirectURL()});
                $(this).removeClass("cur");
                return false;
            }else{
                //添加收藏

                var code = $(this).parent().find("a:eq(0)").attr("id");
                collectionOp("c_addCollection",{ci_cCode:code,ci_cType:01,redirectURL:getRedirectURL()});
                $(this).addClass("cur");
                var _obj = $(this).parent().parent().find("a>img");
                var img = _obj.attr("src");
                var left = _obj.offset().left+(_obj.width()-120)/2;
                var top = _obj.offset().top-$(window).scrollTop()+(_obj.height()-(_obj.width()/_obj.height()*120));
                addPt(1,img,left,top,function(){
                    return false;
                });
            }
        }else{
//				$(".popup_w,.background").css('display','block');
            $("#popuppopup_wpopup_wt,#backGroundColor").css('display','block');
        }
        return false;
    });
    //添加对比车辆（悬浮复选框）
    $(".list-four").delegate(".icon-ratio","click",function(){
        //console.log("添加对比车辆")
        //删除时增加cur
        // if($(this).hasClass("cur") ){
        var id = $(this).attr("id");
        var ids = getCookie("ids");
        if($(this).hasClass("cur")){//执行删除
            if(ids.indexOf(id) < -1){//cookie里面没有了，已经删掉了
                return;
            }
            $(this).removeClass("cur");
            var ids = getCookie("ids");
            var idx = ids.indexOf(",");
            if(idx!=-1){
                var arr = ids.split(",");
                recoverArr(id,arr);
            }else{
                delCookie("ids");
            }
            if(db > 0){
                db--;
                // $(".fix-right .first-icon .redDot").hide();
                $(".fix-right .first-icon .redDot").show().html(db);
            }else {
                $(".fix-right .first-icon .redDot").hide();
            }
            // db--;
            // $(".fix-right .first-icon .redDot").show().html(db);
            // if(db<=0){
            //     $(".fix-right .first-icon .redDot").hide();
            // }
            return false;
        }else{//添加
            var idarr=ids.split(",");
            if(ids == null || ids == ""){//当前没有，直接加入
                setCookie1("ids",id,"0");
                saveCarInfoToCookie(id);
            } else if(ids!=null && ids!=""){
                var idx = ids.indexOf(",");
                if(idx ==-1){//只有1个
                    ids+=","+id;
                    setCookie1("ids",ids,"0");
                    saveCarInfoToCookie(id);
                }else{//2个以上
                    var arr = ids.split(",");
                    for(var i=0 ;i<arr.length;i++){
                        if(id!=arr[i]&&arr.length<3){
                            ids = arr[0]+","+arr[1]+","+id;
                            setCookie1("ids",ids,"0");
                            saveCarInfoToCookie(id);
                        }
                    }
                }
            }

            //kuqi||idarr.length==3
            if($('.icon-ratio.cur').size()>2 ||idarr.length==3 ){
                return false;
            }
            $(this).addClass("cur");
            var _obj = $(this).parent().parent().find("a>img");
            var img = _obj.attr("src");
            var left = _obj.offset().left+(_obj.width()-120)/2;
            var top = _obj.offset().top-$(window).scrollTop()+(_obj.height()-(_obj.width()/_obj.height()*120));
            addPt(0,img,left,top,function(){
                db++;
				/*if(db<=3){*/
                $(".fix-right .first-icon .redDot").show().html(db);
				/*}else{
				 return false;
				 }*/
            });
            return false;
        }
    });
    //点击对比
    $(".first-icon").click(function(){
        //console.log("点击对比3")
        var ids = getCookie("ids");
        console.log(ids);
        if(ids!=null && ids!=""){
            $(".cp").empty();
            $(".btn-add").show();
            var idx = ids.indexOf(",");
            if(idx!=-1){
                var arr = ids.split(",");
                for(var i=0 ;i<arr.length;i++){
                    var carinfohtml = getCookie(arr[i]);
                    console.log(carinfohtml)
                    if(i==0){
                        $(".cp:first").append(carinfohtml);
                        $(".btn-add:first").hide();
                    }else if(i==1){
                        $(".cp:eq(1)").append(carinfohtml);
                        $(".btn-add:eq(1)").hide();
                    }else{
                        $(".cp:last").append(carinfohtml);
                        $(".btn-add:last").hide();
                    }
                }
            }else{
                $(".item .cp").empty();
                $(".btn-add:eq(1)").show();
                $(".btn-add:last").show();
                var carinfohtml = getCookie(ids);
                $(".btn-add:first").hide();
                $(".cp:first").append(carinfohtml);
            }
        }else{
            $(".cp").empty();
            $(".btn-add").show();
        }
        var next = $(".btn-add:visible").size();
        tip((next));
        //删除单个车辆信息
        $(".cst-list").off("click").delegate(".closed","click",function(ev){
            var id = $(this).parent().attr("id");
            var ids = getCookie("ids");
            var idx = ids.indexOf(",");
            if($(".icon-ratio[id="+id+"]").hasClass("cur")){//对比车辆在当前页，去掉勾
                $(".icon-ratio[id="+id+"]").removeClass("cur");
                if(idx!=-1){
                    var arr = ids.split(",");
                    recoverArr(id,arr);
                }else{
                    delCookie("ids");
                    delCookie(ids);
                }
                db--;
                $(".fix-right .first-icon .redDot").show().html(db);
                if(db<=0){
                    $(".fix-right .first-icon .redDot").hide();
                }
            }else{//不在当前页，直接删cookie
                if(idx!=-1){
                    var arr = ids.split(",");
                    recoverArr(id,arr);
                }else{
                    delCookie("ids");
                    delCookie(ids);
                }
				/*我添加的*/
                db--;
                $(".fix-right .first-icon .redDot").show().html(db);
                if(db<=0){
                    $(".fix-right .first-icon .redDot").hide();
                }
				/*我添加的*/
            }

            var idx = $(this).parent().parent().parent().index();//删除索引
            deleteCookieCar(idx);
            var nx = $(".btn-add:visible").size();
            tip(nx);
			/*if(next==2){
			 $(this).parent().parent().parent().find(".btn-add").show();
			 $(this).parent().parent().empty();
			 }else{
			 var idx = $(this).parent().parent().parent().index();
			 deleteCookieCar(idx);
			 }*/
        });
        //对比车辆全部清空按钮
        $(".btn-empty").click(function(){
            db=0;
            $(".fix-right .first-icon .redDot").hide();
            var ids = getCookie("ids");
            var idx = ids.indexOf(",");
            if(idx!=-1){
                var arr = ids.split(",");
                for(var i=0;i<arr.length;i++){
                    if($(".icon-ratio[id="+arr[i]+"]").hasClass("cur")){
                        $(".icon-ratio[id="+arr[i]+"]").removeClass("cur");
                    }
                    delCookie(arr[i]);
                }
            }else{
                if($(".icon-ratio[id="+ids+"]").hasClass("cur")){
                    $(".icon-ratio[id="+ids+"]").removeClass("cur");
                }
                delCookie(ids);
            }
            delCookie("ids");
            $(".cst-list .cp").empty();
            $(".cst-list .btn-add").show();
            contrastBtn(false);
            tip(3);
            return false;
        });
    });
    //查找当前用户是否添加当前车辆到收藏
    var num = [];
    $(".list-four").delegate(".item","mouseover",function(){
       // console.log("是否添加车辆到收藏")
        var _this = $(this);
        if(_this.find(".m a:eq(0)").attr("id")!=undefined){
            if($("#homepageheader input[name='user']").val()!=null){
                if(_this.find(".m a:eq(1)").hasClass("cur")){
                    return;
                }
                var code = _this.find(".m a:eq(0)").attr("id");
                if(num.length>0){
                    for(var i=0;i<num.length;i++){
                        if(code==num[i]){
                            return;
                        }
                    }
                }
                num.push(code);
                $.post(path+"/c_findCollection",{ci_cCode:code},function(data){

                    if(data=="true"){
                        _this.find(".m a:eq(1)").addClass("cur");
                    }
                });


            }

        }

    });
    function arrSelect(arr) {
        for (var i = 0;i < arr.length;i++){

        }
    }
    //车系
    var arr1 = [];
    var obj = {};
    var arr = [];
    var car_typeA = [];
    var car_typeQ = [];
    var car_typeR = [];
    var car_typeS = [];
    var car_typeOthers = [];
    $(".sort-wrap #down-type").click(function(){
        arr = [];
        car_typeA = [];
        car_typeQ = [];
        car_typeR = [];
        car_typeS = [];
        car_typeOthers = [];

        // console.log(typeof arr);
        // console.log($(".type-list a").size());
        if($(".type-list a").size()==6){
            var url = $(".type-list li:eq(0) a").attr("href");
            // $.get(path+"/cms_getCmsLine",function(data){
            $.get(path+"/cms_getModelLines",function(data){
                eval("data=("+data+")");
                $.each(data,function(key,value){
                    arr.push(value);
                    // var div = '<li><a href="'+url+'&ci_ciModelLine='+data[key].cd_cnname+'" onClick="changeType(this)">'+data[key].cd_cnname+'</a></li>';//data[key].cd_cid+


                    // var div = '<li><a href="'+url+'&ci_ciModelLine='+value+'" onClick="changeType(this)">'+value+'</a></li>';//data[key].cd_cid+
                    // $(".type-list").append(div);
                    // $('.type-list a').click(function() {
                    // 	var url = $(this).attr("href");
                    // 	window.location.href = url;
                    // });
                });
                for (var i = 0;i <arr.length;i++){
                    if (arr[i].indexOf("A") == 0){
                        car_typeA.push(arr[i]);
                    }else if (arr[i].indexOf("Q") == 0){
                        car_typeQ.push(arr[i]);
                    }else if (arr[i].indexOf("R") == 0){
                        car_typeR.push(arr[i]);
                    }else if (arr[i].indexOf("S") == 0){
                        car_typeS.push(arr[i]);
                    }else {
                        car_typeOthers.push(arr[i]);
                    }
                }
                console.log(car_typeA);
            });
        }

    });
    var car_typeLi = document.getElementsByClassName("car_typeLi");
    $(".type-list1 li").each(function () {
        var url = $(".hiddle_carType li:eq(0) a").attr("href");
        var index;
        $(this).mouseover(function () {
            index = null;
            $('.hiddle_carType').empty();
            index = $(this).index();
            $(this).addClass("cur").siblings().removeClass("cur");
            $(this).find("img").addClass("cur");
            $(this).siblings().find("img").removeClass("cur");

            $(".hiddle_carType").addClass("cur");
            if (index == 1){
                for (var i = 0;i < car_typeA.length;i++){
                    console.log(i);
                    var div = '<li><a href="'+url+'&ci_ciModelLine='+car_typeA[i]+'" onClick="changeType(this)">'+car_typeA[i]+'</a></li>';
                    $(".hiddle_carType").append(div);
                }
            }else if(index == 2){
                for (var i = 0;i < car_typeQ.length;i++){
                    var div = '<li><a href="'+url+'&ci_ciModelLine='+car_typeQ[i]+'" onClick="changeType(this)">'+car_typeQ[i]+'</a></li>';
                    $(".hiddle_carType").append(div);
                }
            }else if(index == 3){
                for (var i = 0;i < car_typeR.length;i++){
                    var div = '<li><a href="'+url+'&ci_ciModelLine='+car_typeR[i]+'" onClick="changeType(this)">'+car_typeR[i]+'</a></li>';
                    $(".hiddle_carType").append(div);
                }
            }else if(index == 4){
                for (var i = 0;i < car_typeS.length;i++){
                    var div = '<li><a href="'+url+'&ci_ciModelLine='+car_typeS[i]+'" onClick="changeType(this)">'+car_typeS[i]+'</a></li>';
                    $(".hiddle_carType").append(div);
                }
            }else if(index == 5){
                for (var i = 0;i < car_typeOthers.length;i++){
                    var div = '<li><a href="'+url+'&ci_ciModelLine='+car_typeOthers[i]+'" onClick="changeType(this)">'+car_typeOthers[i]+'</a></li>';
                    $(".hiddle_carType").append(div);
                }

            }else if(index == 0){
                for (var i = 0;i < 1;i++){
                    var div = '<li><a href="'+url+'" onClick="changeType(this)">不限车系</a></li>';
                    $(".hiddle_carType").append(div);
                }
            }
            $('.hiddle_carType a').click(function() {
                var url = $(this).attr("href");
                window.location.href = url;
                $('.hiddle_carType').empty().removeClass("cur");
            });

        });
        $("#hiddle_carType_wrap").mouseleave(function () {
            console.log(index);
            $(".type-list1 img").removeClass("cur");
            $(".type-list1 li").removeClass("cur");
            // _this.find("img").removeClass("cur");
            // var first=document.getElementByTagName("div")[0]
            // car_typeLi[index].children[0].removeClass("cur");
            $('.hiddle_carType').empty().removeClass("cur");
        });
    });

    //车型
    $("#s-type").click(function(){
        if($(this).find("a").size()==1){
            if(getQueryString("ci_ciModelLine")!=null){
                var url = $(this).find("li:eq(0) a").attr("href");
                var lineName = getQueryString("ci_ciModelLine");//原来没有加判断，有bug：如果没有选择车系，字典表所有车型都会被查出来，后台一直在查大量字典信息
                if(lineName!=null){
                    // $.post(path+"/cms_getCmsModel",{ci_ciModelLine:lineName},function(data){
                    $.post(path+"/cms_getModelsByLineName",{ci_ciModelLine:lineName},function(data){
                        // console.log(data);
                        eval("data=("+data+")");
                        $.each(data,function(i){
                            // var div='<li style="width: 100%;"><a href="'+url+'&ci_ciModelName='+data[i].cd_cnname+'">'+data[i].cd_cnname+'</a></li>';
                            var div='<li style="width: 100%;"><a href="'+url+'&ci_ciModelName='+data[i]+'">'+data[i]+'</a></li>';
                            $("#s-type ul").append(div);
                            $('#s-type a').click(function() {
                                var url = $(this).attr("href");
                                window.location.href = url;
                            });
                        });
                    });
                }
            }else{
                return;
            }
        }

    });
    //颜色
    $("#s-color").click(function(){
        if($(this).find("a").size()==1){
            var url = $(this).find("li:eq(0) a").attr("href");
            $.post(path+"/cms_getCmsColor",function(data){
                eval("data=("+data+")");
                $.each(data,function(i){
                    var div='<li><a href="'+url+'&ci_ciExteriorColor='+data[i].cd_cid+'">'+data[i].cd_cnname+'</a></li>';
                    $("#s-color ul").append(div);

                    $('#s-color a').click(function() {
                        var url = $(this).attr("href");
                        window.location.href = url;
                    });
                });
            });
        }

    });
    //车系图片
    var line = $("#hiddenLine").val();
    if(line!=null && line!=""){
        var src = $(".fast-red img").attr("src");
        if("A1"==line){
            $(".fast-red img").attr("src",changImg("fast-red1.png",src));
        }else if("A3"==line){
            $(".fast-red img").attr("src",changImg("fast-red2.png",src));
        }else if("A4"==line){
            $(".fast-red img").attr("src",changImg("fast-red3.png",src));
        }else if("A5"==line){
            $(".fast-red img").attr("src",changImg("fast-red4.png",src));
        }else if("A6"==line){
            $(".fast-red img").attr("src",changImg("fast-red5.png",src));
        }else if("A7"==line){
            $(".fast-red img").attr("src",changImg("fast-red6.png",src));
        }else if("A8"==line){
            $(".fast-red img").attr("src",changImg("fast-red7.png",src));
        }else if("Q3"==line){
            $(".fast-red img").attr("src",changImg("fast-red8.png",src));
        }else if("Q5"==line){
            $(".fast-red img").attr("src",changImg("fast-red9.png",src));
        }else if("Q7"==line){
            $(".fast-red img").attr("src",changImg("fast-red10.png",src));
        }else if("TT"==line){
            $(".fast-red img").attr("src",changImg("fast-red11.png",src));
        }else if("R8"==line){
            $(".fast-red img").attr("src",changImg("fast-red12.png",src));
        }

    }

    //图片路径
	/*$(".item .carimg").each(function(){

	 var imgsrc=$(this).attr("src");
	 imgsrc=imgchang(imgsrc,"280x210");
	 $(this).attr("src",imgsrc);
	 }); */



    //device($(window).width(),$(".second-icon"));



	/*if (browser.versions.ios || browser.versions.android || browser.versions.iPhone
	 || browser.versions.iPad) {

	 $("#second-icon").attr("href","/mb_collection?ci_cType=1");
	 }else{

	 $("#second-icon").attr("href","/u_collection?ci_cType=1");

	 }*/



});
function resetSortHeight(){
    $(".sort").height($(".sort-position").height());
}

//加切图尺寸
function imgchang(src,size){
    var index=src.lastIndexOf(".");
    if(index>0){
        var imgtype=src.substring(index);
        src=src.replace(imgtype,"_"+size+imgtype);
    }
    return src;
}
//替换图片名
function changImg(imgName,src){
    var idx = src.lastIndexOf("/");
    var newsrc = src.replace(src.substring(idx+1),imgName);
    return newsrc;
}
//字母数组
var zm=['A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z'];
function getcityList1(){

    $("#citylist1").empty();//清空原list
    for ( var i = 0; i < zm.length; i++) {//循环zm 由于dcitys里的顺序本身就是按照abcd来排序的所以不需要逐个和zm里的ABCD进行比对，只需要按照zm的顺序循环比对即可
        var num=0;//定义num来判断zm和dcity中的字母是否匹配
        for ( var j = 0; j < dcitys.length; j++) {
            if(j>=0){
                var dcity=dcitys[j];//获取每一个dcity对象
                var number=dcity[0];//获取id
                var name=dcity[1];//获取字母与名称
                name=name.split(" "); //分割空格 获取字母与名称的数组
                if(zm[i]==name[0]){

                    if(num<1){
                        $("#citylist1").append("<dl><dt>"+name[0]+"</dt><dd><span><a href='sc?curcity="+number+ "' onclick=changecity('"+name[1]+"')>"+name[1]+"</a></span></dd></dl>");
                    }else{
                        $("#citylist1 dl:last dd:last").append("<span><a href='sc?curcity="+number+ "' onclick=changecity('"+name[1]+"')>"+name[1]+"</a></span>");

                    }
                    num=num+1;
                }
            }
        }
    }
}
function getcityList2(){
    //$("#citylist2").empty();//清空原list
    for ( var i = 0; i < zm.length; i++) {//循环zm 由于dcitys里的顺序本身就是按照abcd来排序的所以不需要逐个和zm里的ABCD进行比对，只需要按照zm的顺序循环比对即可
        var num=0;//定义num来判断zm和dcity中的字母是否匹配
        for ( var j = 0; j < dcitys.length; j++) {
            if(j>=0){
                var dcity=dcitys[j];//获取每一个dcity对象
                var number=dcity[0];//获取id
                var name=dcity[1];//获取字母与名称
                name=name.split(" "); //分割空格 获取字母与名称的数组


                if(zm[i]==name[0]){//如果zm与dcity的字母相同则把对应的信息拼接出来，如果没有相同的则dd不显示对应zm里的字母。

                    if(num<1){
                        //如果在相同zm里，第一次进入则拼接dl
                        $("#citylist2").append("<dl><dt>"+name[0]+"</dt><dd><span><a href='buy?ci_ciArea="+number+ "' onclick=changecity('"+name[1]+"') id='"+number+"'>"+name[1]+"</a></span></dd></dl>");
                    }else{
                        //如果在相同zm里已经有dl则直接在dd里面拼接span
                        $("#citylist2 dl:last dd:last").append("<span><a href='buy?ci_ciArea="+number+ "' onclick=changecity('"+name[1]+"') id='"+number+"'>"+name[1]+"</a></span>");

                    }
                    num=num+1;
                }
            }
        }
    }
}

function getDealercityList1(){
    $("#citylist1").empty();//清空原list
    $.ajax({
        type : "POST",  //提交方式
        url : path+"/openCities",//路径
        success : function(result) {//返回数据根据结果进行相应的处理
            var json = $.parseJSON(result);

            if (json==null||json.msg==null ||json.msg==undefined) {

            } else {
                var obj=eval(json.msg);
                for ( var i = 0; i < zm.length; i++) {//循环zm 由于dcitys里的顺序本身就是按照abcd来排序的所以不需要逐个和zm里的ABCD进行比对，只需要按照zm的顺序循环比对即可
                    var num=0;//定义num来判断zm和dcity中的字母是否匹配
                    for ( var j = 0; j < obj.length; j++) {
                        if(j>=0){
                            var dcity=obj[j];//获取每一个dcity对象
                            var number=dcity.CID;//获取id
                            var name=dcity.REMARK;//获取字母与名称
                            name=name.split(" "); //分割空格 获取字母与名称的数组
                            if(zm[i]==name[0]){//如果zm与dcity的字母相同则把对应的信息拼接出来，如果没有相同的则dd不显示对应zm里的字母。
                                if(num<1){
                                    $("#citylist1").append("<dl><dt>"+name[0]+"</dt><dd><span><a href=javascript:showChangeCity('"+number+"','"+name[1]+"')>"+name[1]+"</a></span></dd></dl>");
                                    $("#citylist2").append("<dl><dt>"+name[0]+"</dt><dd><span><a href='buy?ci_ciArea="+number+ "' onclick=changecity('"+number+"') id='"+number+"'>"+name[1]+"</a></span></dd></dl>");
                                }else{
                                    $("#citylist1 dl:last dd:last").append("<span><a href=javascript:showChangeCity('"+number+"','"+name[1]+"')>"+name[1]+"</a></span>");
                                    $("#citylist2 dl:last dd:last").append("<span><a href='buy?ci_ciArea="+number+ "' onclick=changecity('"+number+"') id='"+number+"'>"+name[1]+"</a></span>");
                                }
                                num=num+1;
                            }
                        }
                    }
                }
            }
        }
    });
}

function getDealercityList2(){
    //$("#citylist2").empty();//清空原list
    $.ajax({
        type : "POST",  //提交方式
        url : path+"/openCities",//路径
        success : function(result) {//返回数据根据结果进行相应的处理
            var json = $.parseJSON(result);

            if (json==null||json.msg==null ||json.msg==undefined) {

            } else {
                var obj=eval(json.msg);
                for ( var i = 0; i < zm.length; i++) {//循环zm 由于dcitys里的顺序本身就是按照abcd来排序的所以不需要逐个和zm里的ABCD进行比对，只需要按照zm的顺序循环比对即可
                    var num=0;//定义num来判断zm和dcity中的字母是否匹配
                    for ( var j = 0; j < obj.length; j++) {
                        if(j>=0){
                            var dcity=obj[j];//获取每一个dcity对象
                            var number=dcity.CID;//获取id
                            var name=dcity.REMARK;//获取字母与名称
                            name=name.split(" "); //分割空格 获取字母与名称的数组
                            if(zm[i]==name[0]){//如果zm与dcity的字母相同则把对应的信息拼接出来，如果没有相同的则dd不显示对应zm里的字母。
                                if(num<1){
                                    //如果在相同zm里，第一次进入则拼接dl
                                    $("#citylist2").append("<dl><dt>"+name[0]+"</dt><dd><span><a href='buy?ci_ciArea="+number+ "' onclick=changecity('"+name[1]+"') id='"+number+"'>"+name[1]+"</a></span></dd></dl>");
                                }else{
                                    //如果在相同zm里已经有dl则直接在dd里面拼接span
                                    $("#citylist2 dl:last dd:last").append("<span><a href='buy?ci_ciArea="+number+ "' onclick=changecity('"+name[1]+"') id='"+number+"'>"+name[1]+"</a></span>");

                                }
                                num=num+1;
                            }
                        }
                    }
                }
            }
        }
    });
}


//自定义价格
function price() {
    var pr1 = $.trim($('#price1').val());
    var pr2 = $.trim($('#price2').val());
    var reg1 = /^[0-9]*$/;
    var reg2 =/^\d+\.\d+$/;//小数
    var iflag1 = reg1.test(pr1);
    var iflag2 = reg1.test(pr2);
    var fflag1 = reg2.test(pr1);
    var fflag2 = reg2.test(pr2);
    var p1,p2;

    if (iflag1) {
        if(pr1!="0"){
            p1 = zeroRep(pr1);
        }else{
            p1=1;
        }

    }else if(fflag1){
        p1 = parseFloat(pr1);
    }else{
        return false;
    }

    if(iflag2){
        p2 = zeroRep(pr2);

    }else if(fflag2){
        p2 = parseFloat(pr2);
    }else{
        return false;
    }
    if (p1 == p2 || p1 < p2) {
        var url = $('.price-list a:first').attr("href");
        window.location.href = url + "&ci_ciPrice=ps" + p1 + "pe" + p2;
        return true;
    }
    //getPrettyNumber
    return false;
}

//自定义公里
function km() {
    var ki1 = $.trim($('#k1').val());
    var ki2 = $.trim($('#k2').val());
    var reg1 = /^[0-9]*$/;// /^([1-9]|[1-5][0-9]|60)$/;//整数
    var reg2 =/^\d+\.\d+$/;//小数
    //var reg = /^(?:0\.\d{1,4}|(?!0)\d+(?:\.\d{1,4})?)$ /;
    var iflag1 = reg1.test(ki1);
    var iflag2 = reg1.test(ki2);
    var fflag1 = reg2.test(ki1);
    var fflag2 = reg2.test(ki2);
    var k1,k2;
    if(iflag1){
        k1 =parseInt(ki1);
    }else if(fflag1){
        k1 = parseFloat(ki1).toFixed(2);
    }else{
        return false;
    }
    if(iflag2){
        k2 =parseInt(ki2);
    }else if(fflag2){
        k2 = parseFloat(ki2).toFixed(2);
    }else{
        return false;
    }
    if(k1==k2 || k1<k2){
        var url = $('#mi-list a:first').attr("href");
        window.location.href = url + "&ci_ciMileage=ks" + k1 + "ke" + k2;
        return true;
    }
    return false;
}
//自定义车龄
function year(){
    var year1 = $.trim($('#y1').val());
    var year2 = $.trim($('#y2').val());
    var reg1 = /^[0-9]*$/;// /^([1-9]|[1-5][0-9]|60)$/;//整数
    var reg2 =/^\d+\.\d+$/;//小数
    var iflag1 = reg1.test(year1);
    var iflag2 = reg1.test(year2);
    var fflag1 = reg2.test(year1);
    var fflag2 = reg2.test(year2);
    var y1,y2;
    if(iflag1){
        y1 =parseInt(year1);
    }else if(fflag1){
        y1 = Math.round(parseFloat(year1));//四舍五入到整数
    }else{
        return false;
    }
    if(iflag2){
        y2 =parseInt(year2);
    }else if(fflag2){
        y2 = Math.round(parseFloat(year2));
    }else{
        return false;
    }
    if(y1==y2 || y1<y2){
        var url = $('#price-list a:first').attr("href");
        window.location.href = url + "&carAge=ys" + y1 + "ye" + y2;
        return true;
    }
    return false;
}
//去掉左边数字0
function zeroRep(str) {
    return parseInt(str.replace(/\b(0+)/gi, ""));//parseInt//parseFloat//toFixed(2)
}
function getcityforid(cid){

    for ( var j = 0; j < dcitys.length; j++) {
        var dcity=dcitys[j];//获取每一个dcity对象
        var number=dcity[0];//获取id
        if(number==cid){
            var name=dcity[1];//获取字母与名称
            name=name.split(" "); //分割空格 获取字母与名称的数组
            return name[1];
        }
    }
    return getCity(cid);
}
function getCity(txt){
    for (var i = 0;i<ocity.length;i++){
        var d = ocity[i];
        var code = d[0];
        if(txt==code){
            var name=d[1];
            return name;
        }
    }
    return "北京";
}
function setarea(idstr,idstr2,idstr3){
//	var cityname=getcityforid($("#"+idstr).text());
    var cityname=getcityforid($("#"+idstr).attr("citynameid"));
    var down = '&nbsp;<span class="icon-down"></span>';
    $("#"+idstr).html(cityname+down);
    $("#"+idstr2).text(cityname);
    var cityname2 = getcityforid($("#"+idstr3).attr("citynameid"));
    $("#"+idstr3).text(cityname2);
}

function GetUrlRelativePath() {
    var url = document.location.toString();
    var arrUrl = url.split("//");
    var start = arrUrl[1].indexOf("/");
    var relUrl = arrUrl[1].substring(start);//截取从start开始到结尾的所有字符
    if(relUrl.indexOf("?") != -1){
        relUrl = relUrl.split("?")[0];
    }
    return relUrl;
}
//去除左右空格
function trim(s){
    return s.replace(/(^\s*)|(\s*$)/g, "");
}

//获取cookie
function getCookie(name) {
    //console.log("获得cookie1")
    if (document.cookie != null && document.cookie.length > 0) {
        var arrStr = document.cookie.split(";");
        for (var i = 0; i < arrStr.length; i++) {
            var temp = arrStr[i].split("=");
            if (trim(temp[0]) == trim(name)) {
                return unescape(temp[1]);
            }
        }
    }
    return "";
}

function delCookie(name)
{
    var exp = new Date();
    exp.setTime(exp.getTime() - 1);
    var cval=getCookie(name);
    if(cval!=null)
        document.cookie= name + "="+escape(cval)+";expires="+exp.toGMTString();
}
//覆盖cookie车辆id
function recoverArr(id,arr){
    if(arr.length==2){
        for(var i = 0; i<arr.length;i++){
            if(id==arr[i]){
                if(i==0){
                    arr =[arr[i+1]];
                    setCookie1("ids",arr,"0");
                    delCookie(id);
                    //saveCarInfoToCookie(id);
                }else{
                    arr =[arr[i-1]];
                    setCookie1("ids",arr,"0");
                    delCookie(id);
                    //saveCarInfoToCookie(id);
                }

            }
        }
    }
    if(arr.length==3){
        for(var i = 0; i<arr.length;i++){
            if(id==arr[i]){
                if(i==0){
                    arr =[arr[i+1],arr[i+2]];
                    setCookie1("ids",arr,"0");
                    delCookie(id);
                }else if(i==1){
                    arr =[arr[i-1],arr[i+1]];
                    setCookie1("ids",arr,"0");
                    delCookie(id);
                }else{
                    arr =[arr[i-2],arr[i-1]];
                    setCookie1("ids",arr,"0");
                    delCookie(id);
                }
            }
        }
    }
}
//添加车辆信息到cookie
function saveCarInfoToCookie(id){
    var detail = $("#info"+id+" .image a").attr("href");
    var imgSrc =  $("#info"+id+" .image a img").attr("src");
    var ctitle =  $("#info"+id+" .info a").attr("title");
    var h3 =  $("#info"+id+" .info h3").text();
    var ci =  $("#info"+id+" .info p:first").text();
    var price =  $("#info"+id+" .info .price").text();
    var dtitle =  $("#info"+id+" .info #dealerurl a").attr("title");
    var ac =  $("#info"+id+" .info #acti").text();
    var carinfo= '<div class="image" id="'+id+'"><a href="javascript:" class="closed"><span></span></a><a href="'+detail+'"><img src="'+imgSrc+'" /></a></div><div class="info"><a href="" class="b-url" title="'+ctitle+'"></a><h3>'+h3+'</h3><p>'+ci+'</p><p class="price">'+price+'</p><p><a href="" class="s-url" title="'+dtitle+'">'+dtitle+'</a> <span class="icon-gold"></span></p><p>'+ac+'</p></div>';
    setCookie1(id, carinfo, "0");
}
//删除车型对比浮层内容
function deleteCookieCar(idx){
    //console.log("删掉对比1")
    if(idx==0){
        $(".btn-add:eq(0)").show();
        $(".cp:eq(0)").empty();
        var txt1 = $(".cp:eq(1)").html();
        var txt2 = $(".cp:eq(2)").html();
        if(txt1!=null && txt1!=""){
            $(".btn-add:eq(0)").hide();
            $(".cp:eq(0)").html(txt1);
            $(".cp:eq(1)").empty();
            $(".btn-add:eq(1)").show();
            if(txt2!=null && txt2!=""){
                $(".cp:eq(1)").html(txt2);
                $(".btn-add:eq(1)").hide();
                $(".cp:eq(2)").empty();
                $(".btn-add:eq(2)").show();
            }
        }
    }else if(idx==1){
        $(".btn-add:eq(1)").show();
        $(".cp:eq(1)").empty();
        var txt2 = $(".cp:eq(2)").html();
        if(txt2!=null && txt2!=""){
            $(".cp:eq(1)").html(txt2);
            $(".btn-add:eq(1)").hide();
            $(".cp:eq(2)").empty();
            $(".btn-add:eq(2)").show();
        }
    }else{
        $(".btn-add:eq(2)").show();
        $(".cp:eq(2)").empty();
    }
	/*for(var i=idx;i<=2;i++){
	 $(".btn-add:eq("+i+")").show();
	 $(".cp:eq("+i+")").empty();
	 if(i!=2){
	 $(".btn-add:eq("+(i+1)+")").show();
	 var txt = $(".cp:eq("+(i+1)+")").html();
	 if(txt!=null && txt!=""){
	 $(".btn-add:eq("+i+")").hide();
	 $(".cp:eq("+(i+1)+")").empty();
	 $(".cp:eq("+i+")").html(txt);
	 }
	 }

	 }*/
}
//显示提示信息
function tip(next){
    if(next==0){
        $(".tip").hide();
        contrastBtn(true);
    }else if(next==1){
        $(".tip").hide();
        contrastBtn(true);
    }else if(next==2){
        $(".tip").show();
        contrastBtn(false);
    }else{
        $(".tip").show();
        contrastBtn(false);
    }
}
//点击右侧悬浮对比按钮
function  contrastBtn(boolean){
    // console.log(document.cookie);
    //console.log("点击对比1")
    var url = $(".btn-db").attr("href");
    var ids = getCookie("ids");
    // ids 首次出现的位置；
    var index = url.indexOf("ids");
    if(!boolean){
        if(index!=-1){
            var oldIds = url.substring(index+4);
            var newurl = url.replace(url.substring(index-1,index+4+(oldIds.length)),"");
            $(".btn-db").attr("href",newurl);
        }
        $(".btn-db").bind("click",function (event) {
            return boolean;
        });
    }else{
        if(index!=-1){
            var oldIds = url.substring(index+4);
            var newurl = url.replace(url.substring(index+4,index+4+(oldIds.length)),ids);
            $(".btn-db").attr("href",newurl);
        }else{
            var newurl = url + ("?ids="+ids);
            $(".btn-db").attr("href",newurl);
        }
        $(".btn-db").off('click').click(function (event) {
            //$(".contrast-box a:eq(0)").click();
            return boolean;
        });
    }
}
//增删收藏
function collectionOp(url,param){
    $.post(url,param);
}
//当前url
function getRedirectURL(){
    var path = window.location.href;
    return encodeURIComponent(path);
}

//var deviceName="PC";
//var pName="MOBILE";
//列表 右侧收藏  判断访问设备
function device(width,obj){
    if(width > 850){
        obj.attr("href",path+"/u_collection?ci_cType=1");
    }else{

        obj.attr("href",path+"/mb_collection?ci_cType=1");

    }

}


function changecity(name){
    location.href=path+"/buy?ci_ciArea="+name;
}
